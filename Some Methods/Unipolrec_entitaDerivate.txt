[ {
  "nome" : "Entita Derivata - Preavviso Eventi Calendario",
  "regola" : "RGLA_PRVVSO_EVNTI_CLNDRO",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 1132,
    "descrizione" : "Entita Derivata - Preavviso Eventi Calendario",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\n\nimport org.joda.time.DateTime\nimport java.sql.Timestamp\nimport java.text.SimpleDateFormat \nimport java.text.DateFormat \n\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\n\tpublic String getNomeCampoChiave() { 'key' }\n\t\t\n\tpublic Collection<?> getCampi() {\n           \n\t    [\n            [\n               nome: 'key',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ],[\n               nome: 'Data',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ],[\n               nome: 'Preavviso',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ], [\n               nome: 'EventoId',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n           ], [\n               nome: 'Descrizione',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ], [\n               nome: 'Oggetto',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ], [\n               nome: 'DataInizio',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\n           ], [\n               nome: 'DataFine',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\n           ],  [\n               nome: 'GiorniTolleranza',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n           ], [\n               nome: 'IstanzaTaskId',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n           ],  [\n               nome: 'CodiceTask',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ], [\n               nome: 'NomeTask',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ], [\n               nome: 'diffGiorniAllaScadenza',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n           ], [\n               nome: 'diffPreavvisoGiorniMancanti',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n           ],  [\n               nome: 'Id_Ufficio',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n           ],  [\n               nome: 'Ufficio',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ],  [\n               nome: 'Id_Referente_Wf',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n           ],  [\n               nome: 'Referente_Wf',\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n           ], [\n    \t       nome: 'NomeReferente_Pratica',\n    \t       tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n    \t   ], [\n    \t       nome: 'IdReferente_Pratica',\n    \t       tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n    \t   ]\n        ]\n\t    \n\t    }\n\t    \n\t\n\tpublic Collection<?> getData() {\n\t    \n\t    /*\n        def eventi = entityManager.createQuery(\"\"\"\n        select \n            new Map(\n                ec.id as EventoId,\n                tec.descrizione as Descrizione,  \n                ec.oggetto as Oggetto, \n                ec.dataInizio as DataInizio,\n                ec.dataFine as DataFine, \n                ec.giorniTolleranza as GiorniTolleranza, \n                ec.giorniPreavviso as GiorniPreavviso, \n                ec.istanzaTask.id as IstanzaTaskId,  \n                dt.codiceNodo as CodiceTask, \n                dt.nome as NomeTask,\n                day_diff(current_date(),ec.dataInizio) as diffGiorniAllaScadenza,\n                ec.giorniPreavviso - day_diff(current_date(),ec.dataInizio) as diffPreavvisoGiorniMancanti\n        \n        \n            )\n        from EventoCalendario ec\n        left join ec.tipoEventoCalendario tec\n        left join ec.istanzaTask it\n        left join it.definizioneTask dt\n        \n        where ec.giorniPreavviso is not null\n        and (ec.giorniPreavviso - day_diff(current_date(),ec.dataInizio)) > 0\n        \n        order by ec.dataInizio\n        \n        \"\"\")\n        .resultList\n        */\n        \n    \tdef eventi =\tentityManager.createQuery(\"\"\"    \n        select                    \n            new Map(\n            \t\t\tec.id as\t\t\t\t\tEventoId,\n            \t\t\ttec.descrizione as\t\t\tDescrizione,\n            \t\t\tec.oggetto as\t\t\t\tOggetto,\n            \t\t\tec.dataInizio as\t\t\tDataInizio,\n            \t\t\tec.dataFine as\t\t\t\tDataFine,\n            \t\t\tec.giorniTolleranza as\t\tGiorniTolleranza,\n            \t\t\tec.giorniPreavviso as       GiorniPreavviso,\n            \t\t\tec.istanzaTask.id as\t\tIstanzaTaskId,\n            \t\t\tdt.codiceNodo as\t\t\tCodiceTask,\n            \t\t\tdt.nome as\t\t\t\t\tNomeTask,\n            \t\t\tday_diff(current_date(), ec.dataInizio) as                      diffGiorniAllaScadenza,\n            \t\t\tec.giorniPreavviso - day_diff(current_date(), ec.dataInizio) as diffPreavvisoGiorniMancanti,\n            \t\t\t\n            \t\t\tsbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\n            \t\t\tsbu.nomeCompleto as \t\t\t\t\t\tUfficio,\n            \t\t\teo.nomeCompleto as                          Referente_Wf,\n                        eo.id as                                    Id_Referente_Wf,\n            \t\t\teor.nomeCompleto as                         NomeReferente_Pratica,\n                        eor.id as                                   IdReferente_Pratica\n            \t\t\t\n            \t\t\t\n            \t\t\t)\n                        \n            from       \tEventoCalendario ec, StoricoPersona sp\n            left join   ec.tipoEventoCalendario                     tec\n            left join   ec.istanzaTask                              it\n            left join   it.definizioneTask                          dt\n                                             \n            left join   it.istanzaProcesso                          ip\n            left join   ip.definizioneProcesso                      dp\n            left join   ec.elementoOrganizzativo                    eo\n            left join   eo.utente                                   u\n                                          \n            left join   sp.storicoBusinessUnit                      sbu\n            left join   sbu.storicoStrutturaOrganizzativa           sso\n            \n            left join   sp.elementoOrganizzativo                    eo\n            left join   eo.referentiStoriciReferentiEntite          sre\n            left join   sre.ruoloReferenteEntita                    rre\n            left join   sre.elementoOrganizzativoReferente          eor\n            \n            \n            \n            \n            where       ec.giorniPreavviso is not null\n            \t\t\tand (ec.giorniPreavviso - day_diff(current_date(),ec.dataInizio)) > 0\n            \t\t\t\n            \t\t\tand sso.corrente = true\n            \t\t\tand sp.elementoOrganizzativo.id = ec.elementoOrganizzativo.id\n            \t\t\t\n            \t\t\tand eo.utente.id = ip.inseritoDa\n            \t\t\t\n                        and sre.corrente = true\n            \t\t\tand rre.descrizione = 'Referente'\n   \t\t\t\n            order by\tec.dataInizio\n        \"\"\")\n        .resultList\n        \n        //where ec.giorniPreavviso is not null\n        //and (ec.giorniPreavviso - day_diff(current_date(),ec.dataInizio)) > 0\n        \n        def plusDayToDate = { sqlTimestamp, daysToAdd ->\n            DateTime data = new DateTime(sqlTimestamp)\n            return data.plusDays(daysToAdd).toDate()\n        }\n        \n        def minusDayToDate = { sqlTimestamp, daysToSubstract ->\n            DateTime data = new DateTime(sqlTimestamp)\n            return data.minusDays(daysToSubstract).toDate()\n        }\n        \n        def DateFormat df = new SimpleDateFormat(\"dd/MM/yyyy\")\n        \n        eventi.each {\n            it.key = it.EventoId + \"_\" + it.IstanzaTaskId + \"_\" + it.CodiceTask\n        \n            it.Oggi = new Date()\n        \n            it.DataPreavvisoString = \"\"\n            it.DataInizioString = \"\"\n            it.DataFineString = \"\"\n            \n            if(it.DataInizio != null){\n                it.DataInizioString = df.format(it.DataInizio)    \n            }\n            if(it.DataFine != null){\n                it.DataFineString = df.format(it.DataFine)\n            }\n            \n            //Gestione Data Preavviso\n            it.DataPreavviso = null\n            if(it.GiorniPreavviso != null){\n                it.DataPreavviso =  minusDayToDate(it.DataInizio, it.GiorniPreavviso)\n                it.DataPreavvisoString = df.format(it.DataPreavviso)\n            }\n            \n            it.Data = it.DataInizioString\n            it.Preavviso = it.DataPreavvisoString\n        \n        }\n        \n        eventi\n    }\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 1132,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "RGLA_PRVVSO_EVNTI_CLNDRO",
      "descrizione" : "Regola Preavviso Eventi Calendario",
      "templateTestoRegola" : null,
      "oggetto_id" : 1132,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 16,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Entita Derivata - Preavviso Eventi Calendario",
    "dataUltimoAggiornamentoDati" : 1555134929358,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 931,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 837,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "Referente_Wf",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 1960,
      "nomeFisico" : "Referente_Wf_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "EventoId",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 489,
      "nomeFisico" : "EventoId_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "IdReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 1961,
      "nomeFisico" : "IdReferente_Pratica_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "Data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 490,
      "nomeFisico" : "Data_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "Id_Referente_Wf",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 1962,
      "nomeFisico" : "Id_Referente_Wf_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 491,
      "nomeFisico" : "key_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "Preavviso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 492,
      "nomeFisico" : "Preavviso_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "DataFine",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 495,
      "nomeFisico" : "DataFine_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "DataInizio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 496,
      "nomeFisico" : "DataInizio_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "Oggetto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 497,
      "nomeFisico" : "Oggetto_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "Descrizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 498,
      "nomeFisico" : "Descrizione_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "NomeTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 499,
      "nomeFisico" : "NomeTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "diffPreavvisoGiorniMancanti",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 819,
      "nomeFisico" : "diffPreavvisoGiorniMancanti_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "diffGiorniAllaScadenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 820,
      "nomeFisico" : "diffGiorniAllaScadenza_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "CodiceTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 501,
      "nomeFisico" : "CodiceTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 821,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "GiorniTolleranza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 503,
      "nomeFisico" : "GiorniTolleranza_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 16,
      "nome" : "IstanzaTaskId",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 506,
      "nomeFisico" : "IstanzaTaskId_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 827,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "diffPreavvisoGiorniMancanti",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 829,
      "nomeFisico" : "diffPreavvisoGiorniMancanti_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "diffGiorniAllaScadenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 830,
      "nomeFisico" : "diffGiorniAllaScadenza_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 16,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 831,
      "nomeFisico" : "Ufficio_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 491
  }
}, {
  "nome" : "Entita Derivata Notifiche/Allarmi",
  "regola" : "RGLA_ENTTA_DRVTA_NTFCHE_ALLRMI_DATA_UDNZA",
  "campoChiave" : "idTask",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 1133,
    "descrizione" : "Regola Entita Derivata per Notifiche e Allarmi",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() { \r\n\t    [\r\n            [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'posizioneId',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'Soggetto',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'Processo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'idTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'idProcesso',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'codiceTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'Task',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'statoIstanzaTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'statoIstanzaProcesso',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'codiceAttributo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'Attributo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'data',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorno',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'diffGiorniAllaScadenza',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'diffGiorniAdOggi',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'idVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'ruoloVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ]\r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        def utentiVisualizzatori = entityManager.createQuery(\"\"\"select distinct \r\n                        new Map (\r\n                            p.id as posizione_id,\r\n                            eo.id as idVisualizzatore,\r\n                            rre.descrizione as ruoloVisualizzatore\r\n                            ) \r\n                    from Posizione p\r\n                        join p.infoEntita ie\r\n                        join ie.storiciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo \r\n                    where rre.descrizione in ('Referente', 'Responsabile Ufficio Referente') \r\n                        and sre.corrente = 1\r\n                \"\"\").resultList\r\n                \r\n        def resultTot = []\r\n        def indice = 0\r\n        def query = entityManager.createQuery(\"\"\"\r\n                    select \r\n                        new Map(\r\n                            p.id as posizioneId,\r\n                            p.intestazione as Soggetto,\r\n                            p.ndgControparte as ndg,\r\n                            dp.nome as Processo,\r\n                            ist.id as idTask,\r\n                            ip.id as idProcesso,\r\n                            dt.codiceIdentificativo as codiceTask,\r\n                            ist.definizioneTask.nome as Task,\r\n                            ist.statoIstanza as statoIstanzaTask,\r\n                            ip.statoIstanza as statoIstanzaProcesso,\r\n                            iat.attributoProcesso.codice as codiceAttributo,\r\n                            iat.attributoProcesso.descrizione as Attributo,\r\n                            iat.valoreData as data,\r\n                            day(iat.valoreData) as giorno,\r\n                            day_diff(current_date(),iat.valoreData) as diffGiorniAllaScadenza,\r\n                            day_diff(iat.valoreData,current_date()) as diffGiorniAdOggi\r\n                        )\r\n                    from EntitaProcesso ep, Posizione p\r\n                        join ep.istanzaProcesso ip\r\n                        join ip.definizioneProcesso dp\r\n                        join ip.istanzeTasks ist\r\n                        join ist.definizioneTask dt \r\n                        left join ist.istanzeAttributiTasks iat\r\n                        \r\n                        join p.infoEntita ie_p\r\n                        join ie_p.storiciReferentiEntite sre_p\r\n                        join sre_p.elementoOrganizzativoReferente eo_p \r\n                    where\r\n                        ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                        and ep.idEntita = p.id\r\n                        and sre_p.corrente = 1\r\n                        and dt.codiceIdentificativo in ('DPSTO_CTU_r7', 'AGGDCZNE', 'DPSTO_CTU_r9', 'AGGDCZNE_r1')\r\n                \"\"\").resultList.each\r\n                        { it ->\r\n                            utentiVisualizzatori.each\r\n                            { it_pl ->\r\n                                if(it_pl.posizione_id == it.posizioneId)\r\n                                {\r\n                                    it['key'] = \"\"+it.idTask + \" - \"+ it.posizioneId + \" - \" + it_pl.idVisualizzatore\r\n                                    def copy = [:]\r\n                                    copy.putAll(it)\r\n                                    copy.putAll(it_pl)\r\n                                    copy.id = indice++\r\n                                    resultTot << copy\r\n                                }\r\n                            }\r\n                        }\r\n                        \r\n                        \r\n        resultTot\r\n\r\n\r\n    }\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 1133,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "RGLA_ENTTA_DRVTA_NTFCHE_ALLRMI_DATA_UDNZA",
      "descrizione" : "Regola Entità Derivata Notifiche/Allarmi",
      "templateTestoRegola" : null,
      "oggetto_id" : 1133,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 17,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Entita Derivata Notifiche/Allarmi",
    "dataUltimoAggiornamentoDati" : 1555135000677,
    "campiEntiteDerivate" : [ {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "Processo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 513,
      "nomeFisico" : "Processo_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "Soggetto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 514,
      "nomeFisico" : "Soggetto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 17,
      "nome" : "statoIstanzaTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 738,
      "nomeFisico" : "statoIstanzaTask_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "Task",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 515,
      "nomeFisico" : "Task_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 17,
      "nome" : "statoIstanzaProcesso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 739,
      "nomeFisico" : "statoIstanzaProcesso_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "posizioneId",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 516,
      "nomeFisico" : "posizioneId_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 17,
      "nome" : "ruoloVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 740,
      "nomeFisico" : "ruoloVisualizzatore_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "diffGiorniAdOggi",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 517,
      "nomeFisico" : "diffGiorniAdOggi_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 17,
      "nome" : "idVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 741,
      "nomeFisico" : "idVisualizzatore_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "Attributo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 518,
      "nomeFisico" : "Attributo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 17,
      "nome" : "idProcesso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 742,
      "nomeFisico" : "idProcesso_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "codiceTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 519,
      "nomeFisico" : "codiceTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 17,
      "nome" : "idTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 743,
      "nomeFisico" : "idTask_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "giorno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 507,
      "nomeFisico" : "giorno_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 508,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "codiceAttributo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 509,
      "nomeFisico" : "codiceAttributo_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 510,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 17,
      "nome" : "diffGiorniAllaScadenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 511,
      "nomeFisico" : "diffGiorniAllaScadenza_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 743
  }
}, {
  "nome" : "Processi",
  "regola" : "PRCSSI",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 1134,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n\t    \r\n\t    \r\n\t    [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'mandante',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t    ], [\r\n    \t        nome: 'mandante_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t    ],  [\r\n    \t        nome: 'gestore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t    ], [\r\n    \t        nome: 'gestore_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t    ], [\r\n    \t        nome: 'processo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t    ],  [\r\n    \t        nome: 'data',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorni',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'esecutore_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'Ufficio',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'Id_Ufficio',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ] \r\n\t    ]\r\n\t    \r\n\t    \r\n\t    }\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        entityManager.createQuery(\"\"\"select\r\n            new Map(\r\n                ip.id as id,\r\n                p.id as posizione_id,\r\n                p.intestazione as intestazione,\r\n                p.ndgControparte as ndg,\r\n                eo_m.id as mandante_id,\r\n                eo_m.nomeCompleto as mandante,\r\n                eo_r.id as gestore_id,\r\n                eo_r.nomeCompleto as gestore,\r\n                dp.nome as processo,\r\n                ip.dataCreazione as data,\r\n                day_diff(ip.dataCreazione, current_date()) as giorni,\r\n                eo.id as esecutore_id,\r\n                eo.nomeCompleto as esecutore,\r\n                eo.classeElementoOrganizzativo as esecutore_classe,\r\n                eo.esterno as esecutore_esterno,\r\n            \t\r\n                sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \tsbu.nomeCompleto as \t\t\t\t\t\tUfficio,\r\n                eor.nomeCompleto as                         NomeReferente_Pratica,\r\n                eor.id as                                   IdReferente_Pratica\r\n                \r\n            )\r\n            from\r\n                IstanzaProcesso ip, Posizione p, Utente u, StoricoPersona sp\r\n                join ip.entiteProcessi ep\r\n                join ip.definizioneProcesso dp\r\n                join p.elementoOrganizzativoMandante eo_m\r\n                join p.infoEntita ie\r\n                left join ie.storiciReferentiEntite sre\r\n                left join sre.ruoloReferenteEntita rre\r\n                left join sre.elementoOrganizzativoReferente eo_r\r\n                join u.elementoOrganizzativo eo\r\n                \r\n                left join   sp.storicoBusinessUnit                      sbu\r\n                left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                join p.infoEntita                                       ie\r\n                join sre.ruoloReferenteEntita                           rre\r\n                join sre.elementoOrganizzativoReferente                 eor\r\n                \r\n            where\r\n                ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                and p.id = ep.idEntita\r\n                and u.id = ip.inseritoDa\r\n                \r\n                and sso.corrente = true\r\n            \tand sp.elementoOrganizzativo.id = u.elementoOrganizzativo.id\r\n            \tand sre.infoEntita.id = p.infoEntita.id\r\n                and sre.corrente = true\r\n                and rre.descrizione = 'Referente'\r\n                \r\n                \"\"\")\r\n            .resultList\r\n    }\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 1134,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PRCSSI",
      "descrizione" : "Processi",
      "templateTestoRegola" : null,
      "oggetto_id" : 1134,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 18,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Processi",
    "dataUltimoAggiornamentoDati" : 1555135002279,
    "campiEntiteDerivate" : [ {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 520,
      "nomeFisico" : "giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 18,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 936,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "processo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 521,
      "nomeFisico" : "processo_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "esecutore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 522,
      "nomeFisico" : "esecutore_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 18,
      "nome" : "IdReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 1963,
      "nomeFisico" : "IdReferente_Pratica_i"
    }, {
      "multivalore" : false,
      "descrizione" : "istituto",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "mandante",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 524,
      "nomeFisico" : "mandante_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 525,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 526,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "gestore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 527,
      "nomeFisico" : "gestore_id_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "mandante_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 528,
      "nomeFisico" : "mandante_id_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 18,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 530,
      "nomeFisico" : "intestazione_t"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 18,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 532,
      "nomeFisico" : "ndg_t"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "gestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 533,
      "nomeFisico" : "gestore_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 18,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 853,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 18,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 534,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 18,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 855,
      "nomeFisico" : "Id_Ufficio_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 525
  }
}, {
  "nome" : "Garanzie ipotecarie",
  "regola" : "GRNZE_IPTCRE",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 1135,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "new it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() { }\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        entityManager.createQuery(\"\"\"select\r\n            new Map(\r\n                g.id as id,\r\n                g.codiceOriginario as codiceOriginario,\r\n                g.dataScadenza as dataScadenza,\r\n                g.valoreNominale as valoreNominale,\r\n                tg.descrizione as tipo,\r\n                p.id as posizione_id,\r\n                p.intestazione as intestazione,\r\n                p.ndgControparte as ndg,\r\n                eo_m.id as mandante_id,\r\n                eo_m.nomeCompleto as mandante,\r\n                eo_g.id as gestore_id,\r\n                eo_g.nomeCompleto as gestore,\r\n                day_diff(g.dataScadenza, current_date()) as giorni\r\n            )\r\n            from \r\n                Garanzia g\r\n                left join g.tipoGaranzia tg\r\n                join g.posizione p\r\n                join p.infoEntita ie\r\n                left join ie.storiciReferentiEntite srp_g \r\n                left join srp_g.ruoloReferenteEntita rre_g\r\n                left join srp_g.elementoOrganizzativoReferente eo_g\r\n                left join p.elementoOrganizzativoMandante eo_m\r\n            where\r\n                g.classeGaranzia = it.sydema.laweb.domain.Enums\\$ClasseGaranzia.IPOTECARIA\r\n                and srp_g.corrente = true\r\n                and rre_g.descrizione = 'Gestore'\"\"\")\r\n            .resultList\r\n\t}\r\n}\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 1135,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "GRNZE_IPTCRE",
      "descrizione" : "Garanzie ipotecarie",
      "templateTestoRegola" : null,
      "oggetto_id" : 1135,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 19,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Garanzie ipotecarie",
    "dataUltimoAggiornamentoDati" : 1555135002705,
    "campiEntiteDerivate" : [ {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "valoreNominale",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 544,
      "nomeFisico" : "valoreNominale_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 545,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 546,
      "nomeFisico" : "giorni_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 547,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "dataScadenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 535,
      "nomeFisico" : "dataScadenza_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 19,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 536,
      "nomeFisico" : "ndg_t"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 19,
      "nome" : "codiceOriginario",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 537,
      "nomeFisico" : "codiceOriginario_t"
    }, {
      "multivalore" : false,
      "descrizione" : "istituto",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "mandante",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 538,
      "nomeFisico" : "mandante_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 19,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 539,
      "nomeFisico" : "intestazione_t"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "gestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 540,
      "nomeFisico" : "gestore_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "gestore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 541,
      "nomeFisico" : "gestore_id_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "mandante_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 542,
      "nomeFisico" : "mandante_id_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 19,
      "nome" : "tipo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 543,
      "nomeFisico" : "tipo_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 547
  }
}, {
  "nome" : "Posizioni",
  "regola" : "PSZNI",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 1136,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\n\ndef referentiWF = entityManager.createQuery(\"\"\"select\n    new Map(\n        ep.idEntita as procedura_id,\n        ep2.idEntita as posizione_id,\n        iat.valoreIntero as id,\n        iat.valoreStringa as nomeReferente\n     )\n    from EntitaProcesso ep, EntitaProcesso ep2\n        join ep.istanzaProcesso ip\n        join ip.istanzeTasks it\n        join it.definizioneTask dt\n        join it.istanzeAttributiTasks iat\n        join iat.attributoProcesso ap\n        \n        join ep2.istanzaProcesso ip2\n    where\n        ap.codice in ('LGLE_INCRCTO','LGLE_INCRCTO_r1','LGLE_INCRCTO_r2')\n        and ep.entita = it.sydema.laweb.domain.Enums\\$Entita.PROCEDURA_LEGALE\n        and ep2.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\n        and ip.id = ip2.id\n        \"\"\")\n    .resultList\n\ndef referenti = []    \ndef index = 0\n\ndef referentiAttuali = entityManager.createQuery(\"\"\"select\n    new Map(\n        ie.idEntita as procedura_id,\n        eap.idElemento as posizione_id,\n        rre.descrizione as ruolo,\n        eo.id as id,\n        eo.nomeCompleto as nome,\n        sre.dataInizioValidita as data,\n        day_diff(sre.dataInizioValidita, current_date()) as giorni\n    )\n    from\n        InfoEntita ie, ProceduraLegale pl\n        join ie.storiciReferentiEntite sre\n        join sre.ruoloReferenteEntita rre\n        join sre.elementoOrganizzativoReferente eo\n        join pl.elementiAssociatiProcedureLegali eap with eap.tipoElementoAssociatoProceduraLegale = it.sydema.laweb.domain.Enums\\$TipoElementoAssociatoProceduraLegale.POSIZIONE\n    where\n        ie.entita = it.sydema.laweb.domain.Enums\\$Entita.PROCEDURA_LEGALE\n        and ie.idEntita = pl.id\n        and sre.corrente = true\n        and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente', 'SLE', 'SRE')\"\"\")\n    .resultList\nreferentiAttuali.each\n{ it ->\n    referentiWF.each\n    { it2 ->\n        if(it.procedura_id == it2.procedura_id)\n        {\n            def copy = [:]\n            copy.putAll(it)\n            copy.id = it.id\n            referenti << copy\n        }\n    }\n        \n}\n\ndef referenti2 = []\n\ndef referentiBU = entityManager.createQuery(\"\"\"\n    select distinct new Map(\n    \teo.id as id,\n    \teo.nomeCompleto as nome,\n    \tsbu.elementoOrganizzativo.id as sbuId,\n    \teor.id as gestoreId\n    )\n    from ElementoOrganizzativo eo, RuoloReferenteEntita rre\n    join eo.storiciPersone sp\n    join sp.storicoBusinessUnit sbu\n    join sbu.storicoStrutturaOrganizzativa sso\n    \n    join rre.storiciReferentiEntite sre\n    join sre.elementoOrganizzativoReferente eor\n    join eo.storiciPersone spr\n    join sp.storicoBusinessUnit sbur\n    where sre.corrente = true\n        and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\n        and sso.corrente = true\n        and sbu.id = sbur.id\n    \"\"\").resultList \nreferenti.each\n{ referente ->\n    def presente = false\n    referentiBU.each\n    { referenteBusinessUnit ->\n        if(referente.id == referenteBusinessUnit.gestoreId)\n        {\n            presente = true\n            def copy2 = [:]\n            copy2.putAll(referente)\n            copy2.id = referenteBusinessUnit.id\n            copy2.nome = referenteBusinessUnit.nome\n            referenti2 << copy2\n        }\n    }\n    if(presente == false)\n        referenti2 << referente\n    \n}\n    \n// posizioni\ndef posizioni = entityManager.createQuery(\"\"\"select\n    new Map(\n        p.id as id,\n        p.intestazione as intestazione,\n        p.ndgControparte as ndg,\n        eo.id as mandante_id,\n        eo.nomeCompleto as mandante,\n\t\t'Studio legale esterno' as classeSLE\n    )\n    from\n        Posizione p\n        left join p.elementoOrganizzativoMandante eo\n        where p.dataChiusura is null\"\"\")\n    .resultList\n    .each \n    { \n        item ->\n        // integro le informazioni sui referenti\n        referenti2.each{ ref ->\n            if (ref.posizione_id == item.id)\n            { \n                    def prefix = ref.ruolo == 'Società Recupero Esterna' ? 'sre_' :\n                        (ref.ruolo == 'Legale Esterno' || ref.ruolo == 'SLE' || ref.ruolo == 'Studio Legale Esterno Procedura' || ref.ruolo == 'Studio Legale Esterno') ? 'sle_' : 'gestore_'\n\n                    item[prefix + 'id'] = ref.id\n                    item[prefix] = ref.nome\n                    item[prefix + 'giorni'] = ref.giorni\n                    item['data'] = ref.data\n\n                }\n        }\n    }\n\n\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\n\tpublic String getNomeCampoChiave() { 'id' }\n\n\tpublic Collection<?> getCampi() {\n\t    [       \n\t        [   \n            \tnome: 'id',\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n            ],\n            [   \n            \tnome: 'istituto',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n            ],\n            [   \n            \tnome: 'ndg',\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n            ],\n            [   \n            \tnome: 'intestazione',\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n            ],\n            [   \n            \tnome: 'gestore',\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n            ],\n            [   \n            \tnome: 'gestore_giorni',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n            ],\n            [   \n            \tnome: 'gestore_id',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n            ],\n            [   \n            \tnome: 'sle',\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n            ],\n            [   \n            \tnome: 'sle_giorni',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n            ],\n            [   \n            \tnome: 'sle_id',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n            ],\n            [   \n            \tnome: 'sre',\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\n            ],\n            [   \n            \tnome: 'sre_giorni',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n            ],\n            [   \n            \tnome: 'sre_id',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\n            ],\n            [   \n            \tnome: 'data',\t\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\n            ]\n    \t ]\n\t}\n\t\n\tpublic Collection<?> getData() {\n        posizioni\n\t}\n}\n\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 1136,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PSZNI",
      "descrizione" : "Posizioni",
      "templateTestoRegola" : null,
      "oggetto_id" : 1136,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 20,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Posizioni",
    "dataUltimoAggiornamentoDati" : 1553174122101,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "CodiceReferente_Prattica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 909,
      "nomeFisico" : "CodiceReferente_Prattica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "gestore_giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 914,
      "nomeFisico" : "gestore_giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "gestore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 915,
      "nomeFisico" : "gestore_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "istituto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 916,
      "nomeFisico" : "istituto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "sre_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 917,
      "nomeFisico" : "sre_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "sre_giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 918,
      "nomeFisico" : "sre_giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "sre",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 919,
      "nomeFisico" : "sre_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "sle_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 920,
      "nomeFisico" : "sle_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "sle_giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 921,
      "nomeFisico" : "sle_giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "sle",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 922,
      "nomeFisico" : "sle_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "CodiceReferente_Prattica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 923,
      "nomeFisico" : "CodiceReferente_Prattica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 924,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "NomeReferente_Prattica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 925,
      "nomeFisico" : "NomeReferente_Prattica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 926,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 20,
      "nome" : "gestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 927,
      "nomeFisico" : "gestore_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 547
  }
}, {
  "nome" : "Entita Derivata - Notifica/Allarmi di Chiusura Task",
  "regola" : "NTFCA_ALLRMI_CHSRA_TASK",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 4768,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'posizioneId',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'Soggetto',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'Processo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'codiceTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'Task',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'dataChiusuraTask',\r\n    \t        desrizione: \"Data chiusura task\",\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'ruolo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'idReferente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeReferente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'dataInizioValiditaReferente',\r\n    \t        desrizione: \"Data inizio validità referente\",\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorniReferente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'giorniTrascorsiDaChiusura',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'oggi',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ]\r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        entityManager.createQuery(\"\"\"\r\n        select \r\n            new Map(\r\n                p.id as posizioneId,\r\n                p.intestazione as Soggetto,\r\n                p.ndgControparte as ndg,\r\n                dp.nome as Processo,\r\n                ist.definizioneTask.codiceIdentificativo as codiceTask,\r\n                ist.definizioneTask.nome as Task,\r\n                ist.dataChiusura as dataChiusuraTask,\r\n                rre.descrizione as ruolo,\r\n                eo.id as idReferente,\r\n                eo.nomeCompleto as nomeReferente,\r\n                sre.dataInizioValidita as dataInizioValiditaReferente,\r\n                day_diff(sre.dataInizioValidita, current_date()) as giorniReferente,\r\n                day_diff(ist.dataChiusura, current_date()) as giorniTrascorsiDaChiusura,\r\n                current_date() as oggi\r\n            )\r\n        from EntitaProcesso ep, Posizione p\r\n            left join ep.istanzaProcesso ip\r\n            left join ip.definizioneProcesso dp\r\n            left join ip.istanzeTasks ist\r\n            left join ist.istanzeAttributiTasks iat\r\n            left join p.infoEntita ie\r\n            left join ie.storiciReferentiEntite sre\r\n            left join sre.ruoloReferenteEntita rre\r\n            left join sre.elementoOrganizzativoReferente eo\r\n        where\r\n            ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n            and ep.idEntita = p.id\r\n            and ist.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.CONCLUSO\r\n            and ip.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.ATTIVO\r\n            and sre.corrente = true\r\n            and rre.descrizione = 'Gestore'\r\n            and ( \"\"\"\r\n            \r\n                        //Esecuzione Immobiliare\r\n            +\"\"\"    (\r\n                    ist.definizioneTask.codiceIdentificativo in ('AGGDCZNE','DPSTO_CTU_r7')\r\n                    ) or \"\"\"\r\n                        //Intervento in Esecuzione Immobiliare\r\n            +\"\"\"    (\r\n                    ist.definizioneTask.codiceIdentificativo in ('AGGDCZNE_r1','DPSTO_CTU_r9')\r\n                    ) \"\"\"\r\n            +\"\"\")\r\n                \r\n                order by iat.valoreData asc\r\n        \"\"\").resultList\r\n    }\r\n}\r\n\r\n\r\n\r\n/*\r\nimport java.text.SimpleDateFormat\r\n\r\ndef istanze = query\r\n\r\nSimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd\")\r\ndef istanzeGestore = []\r\n\r\nistanze.each {\r\n    def dataChiusuraTask = dateFormat.format(it.dataChiusuraTask)\r\n    def oggi = dateFormat.format(it.oggi)\r\n    if(dataChiusuraTask.equals(oggi) || it.giorniTrascorsiDaChiusura<=2){\r\n        it.key = it.posizioneId + \"_\" + it.codiceTask + \"_\" + it.dataChiusuraTask\r\n        istanzeGestore << it\r\n    }\r\n}\r\n\r\nistanzeGestore\r\n*/",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 4768,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "NTFCA_ALLRMI_CHSRA_TASK",
      "descrizione" : "Notifica/Allarmi Alla Chiusura Del Task",
      "templateTestoRegola" : null,
      "oggetto_id" : 4768,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 22,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Entita Derivata - Notifica/Allarmi di Chiusura Task",
    "dataUltimoAggiornamentoDati" : 1552807154816,
    "campiEntiteDerivate" : [ {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "dataInizioValiditaReferente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 800,
      "nomeFisico" : "dataInizioValiditaReferente_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "nomeReferente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 801,
      "nomeFisico" : "nomeReferente_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "giorniReferente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 802,
      "nomeFisico" : "giorniReferente_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "codiceTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 803,
      "nomeFisico" : "codiceTask_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "Soggetto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 804,
      "nomeFisico" : "Soggetto_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "idReferente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 805,
      "nomeFisico" : "idReferente_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "Task",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 806,
      "nomeFisico" : "Task_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "dataChiusuraTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 807,
      "nomeFisico" : "dataChiusuraTask_dt"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "Processo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 808,
      "nomeFisico" : "Processo_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 809,
      "nomeFisico" : "key_i"
    }, {
      "multivalore" : false,
      "descrizione" : "",
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "posizioneId",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 810,
      "nomeFisico" : "posizioneId_i"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "ruolo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 811,
      "nomeFisico" : "ruolo_s"
    }, {
      "multivalore" : false,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : false,
      "entitaDerivata_id" : 22,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 812,
      "nomeFisico" : "ndg_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 809
  }
}, {
  "nome" : "Presa visione",
  "regola" : "PRSA_VSNE",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 8349,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() { \r\n\t    [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'oggetto',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'data',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoMittente_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoMittente_nomeCompleto',\r\n    \t        descrizione: 'Mittente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ]\r\n    \t    /*, [\r\n    \t        nome: 'elementoOrganizzativoDestinatario_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoDestinatario_nomeCompleto',\r\n    \t        descrizione: 'Destinatario',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ]*/\r\n    \t     , [\r\n    \t        nome: 'dataPresaVisione',\r\n    \t        descrizione: 'Data presa visione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorni',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        entita: Entita.POSIZIONE\r\n    \t    ], [\r\n    \t        nome: 'posizione_intestazione',\r\n    \t        descrizione: 'Posizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ]\r\n    \t]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        /*entityManager.createQuery(\"\"\"select \r\n            new Map(\r\n                d.id as id,\r\n                c.oggetto as oggetto,\r\n                c.data as data,\r\n                eom.id as elementoOrganizzativoMittente_id,\r\n                eom.nomeCompleto as elementoOrganizzativoMittente_nomeCompleto,\r\n                eod.id as elementoOrganizzativoDestinatario_id,\r\n                eod.nomeCompleto as elementoOrganizzativoDestinatario_nomeCompleto,\r\n                d.dataPresaVisione as dataPresaVisione,\r\n                day_diff(d.dataPresaVisione, current_date()) as giorni,\r\n                p.id as posizione_id,\r\n                p.intestazione as posizione_intestazione\r\n            )\r\n            from \r\n                Comunicazione c\r\n                join c.elementoOrganizzativoMittente eom\r\n                join c.destinatariComunicazioni d\r\n                join d.elementoOrganizzativo eod\r\n                left join c.posizione p\r\n            where\r\n                coalesce(c.bozza, false) = false\r\n                and d.dataPresaVisione is not null\r\n                and day_diff(d.dataPresaVisione, current_date()) < 30\"\"\")\r\n            .resultList*/\r\n        \r\n        entityManager.createQuery(\"\"\"select \r\n            new Map(\r\n                vcdest.id as id,\r\n                c.oggetto as oggetto,\r\n                c.data as data,\r\n                eom.id as elementoOrganizzativoMittente_id,\r\n                eom.nomeCompleto as elementoOrganizzativoMittente_nomeCompleto,\r\n                vcdest.dataPresaVisione as dataPresaVisione,\r\n                day_diff(vcdest.dataPresaVisione, current_date()) as giorni,\r\n                p.id as posizione_id,\r\n                p.intestazione as posizione_intestazione\r\n            )\r\n            from \r\n                Comunicazione c, Posizione p\r\n                join c.infiEntite ie\r\n                join c.visibiliteComunicazioni vcdest\r\n                join c.visibiliteComunicazioni vcmitt\r\n                join vcmitt.elementoOrganizzativo eom\r\n                \r\n            where\r\n                c.data is not null\r\n                and ie.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                and p.id = ie.idEntita\r\n                and vcmitt.ruoloPartecipanteComunicazione = it.sydema.laweb.domain.Enums\\$RuoloPartecipanteComunicazione.MITTENTE\r\n                and vcdest.ruoloPartecipanteComunicazione != it.sydema.laweb.domain.Enums\\$RuoloPartecipanteComunicazione.MITTENTE\r\n                and vcdest.dataPresaVisione is not null\r\n                and day_diff(vcdest.dataPresaVisione, current_date()) < 30\"\"\")\r\n            .resultList\r\n\t}\r\n}\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 8349,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PRSA_VSNE",
      "descrizione" : "Presa visione",
      "templateTestoRegola" : null,
      "oggetto_id" : 8349,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 23,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Presa visione",
    "dataUltimoAggiornamentoDati" : 1552807154726,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 592,
      "nomeFisico" : "giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "elementoOrganizzativoDestinatario_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 593,
      "nomeFisico" : "elementoOrganizzativoDestinatario_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 23,
      "nome" : "oggetto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 594,
      "nomeFisico" : "oggetto_t"
    }, {
      "multivalore" : null,
      "descrizione" : "Mittente",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "elementoOrganizzativoMittente_nomeCompleto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 595,
      "nomeFisico" : "elementoOrganizzativoMittente_nomeCompleto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : "POSIZIONE",
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 596,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 586,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Destinatario",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "elementoOrganizzativoDestinatario_nomeCompleto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 587,
      "nomeFisico" : "elementoOrganizzativoDestinatario_nomeCompleto_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Data presa visione",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "dataPresaVisione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 588,
      "nomeFisico" : "dataPresaVisione_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "elementoOrganizzativoMittente_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 589,
      "nomeFisico" : "elementoOrganizzativoMittente_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Posizione",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 23,
      "nome" : "posizione_intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 590,
      "nomeFisico" : "posizione_intestazione_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 23,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 591,
      "nomeFisico" : "id_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 591
  }
}, {
  "nome" : "Posizioni assistite da garanzia",
  "regola" : "PSZNI_ASSSTTE_GRNZA",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 8350,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Sistema",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        entita: Entita.POSIZIONE\r\n    \t    ], [\r\n    \t        nome: 'intestazionePosizione',\r\n    \t        descrizione: 'Nominativo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'codicePratica',\r\n    \t        descrizione: 'Posizione Syges3',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'garanzia_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        entita: Entita.GARANZIA\r\n    \t    ], [\r\n    \t        nome: 'codiceOriginario',\r\n    \t        descrizione: 'Identificativo garanzia',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'tipoGaranzia',\r\n    \t        descrizione: 'Tipo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'valoreNominale',\r\n    \t        descrizione: 'Importo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DECIMALE\r\n    \t    ], [\r\n    \t        nome: 'garante_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'garante',\r\n    \t        descrizione: 'Garante',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'ndg_garante',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n               nome: 'Id_Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n           ],  [\r\n               nome: 'Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ]\r\n\t    ]\r\n\t}\r\n\t\t\t\r\n\tpublic Collection<?> getData() {\r\n        entityManager.createQuery(\"\"\"\r\n            select new Map(\r\n                gsa.id as key,\r\n                p.id as posizione_id,\r\n                p.intestazione as intestazionePosizione,\r\n                p.ndgControparte as ndg,\r\n                p.codicePratica as codicePratica,\r\n                g.id as garanzia_id,\r\n                g.codiceOriginario as codiceOriginario,\r\n                t.descrizione as tipoGaranzia,\r\n                g.valoreNominale as valoreNominale,\r\n                sa.id as garante_id,\r\n                sa.nomeCompleto as garante,\r\n                saeo.ndg as ndg_garante,\r\n                \r\n                eor.nomeCompleto as                         NomeReferente_Pratica,\r\n                eor.id as                                   IdReferente_Pratica,\r\n                sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \tsbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n                \r\n            )\r\n            from\r\n                Posizione p, StoricoReferenteEntita sre, StoricoPersona sp\r\n                join p.garanzie g\r\n                join g.tipoGaranzia t\r\n                join g.garanzie_SoggettiAnagrafici gsa\r\n                join gsa.soggettoAnagrafico sa\r\n                join sa.soggettiAnagrafici_ElementiOrganizzativi saeo\r\n                \r\n                join p.infoEntita ie\r\n                join sre.ruoloReferenteEntita rre\r\n                join sre.elementoOrganizzativoReferente eor\r\n                \r\n                left join   sp.storicoBusinessUnit                      sbu\r\n                left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                \r\n            where\r\n                p.dataChiusura is null\r\n                \r\n                and sre.infoEntita.id = p.infoEntita.id\r\n                and sre.corrente = true\r\n                and rre.descrizione = 'Referente'\r\n                \r\n                and sso.corrente = true\r\n            \tand sp.elementoOrganizzativo.id = sre.elementoOrganizzativoReferente.id\r\n                \r\n                \"\"\")\r\n            .resultList\r\n\t}\r\n}\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 8350,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PSZNI_ASSSTTE_GRNZA",
      "descrizione" : "Posizioni assistite da garanzia",
      "templateTestoRegola" : null,
      "oggetto_id" : 8350,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 24,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Posizioni assistite da garanzia",
    "dataUltimoAggiornamentoDati" : 1552807157192,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : "Identificativo garanzia",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "codiceOriginario",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 608,
      "nomeFisico" : "codiceOriginario_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 844,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 845,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 846,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "CodiceReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 847,
      "nomeFisico" : "CodiceReferente_Pratica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : "GARANZIA",
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "garanzia_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 597,
      "nomeFisico" : "garanzia_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 24,
      "nome" : "ndg_garante",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 598,
      "nomeFisico" : "ndg_garante_t"
    }, {
      "multivalore" : null,
      "descrizione" : "Importo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DECIMALE",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "valoreNominale",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 599,
      "nomeFisico" : "valoreNominale_d"
    }, {
      "multivalore" : null,
      "descrizione" : "Tipo",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "tipoGaranzia",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 600,
      "nomeFisico" : "tipoGaranzia_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : "POSIZIONE",
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 601,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Posizione Syges3",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "codicePratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 602,
      "nomeFisico" : "codicePratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Garante",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "garante",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 603,
      "nomeFisico" : "garante_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "garante_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 604,
      "nomeFisico" : "garante_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 24,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 605,
      "nomeFisico" : "ndg_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 24,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 606,
      "nomeFisico" : "key_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Nominativo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 24,
      "nome" : "intestazionePosizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 607,
      "nomeFisico" : "intestazionePosizione_t"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 606
  }
}, {
  "nome" : "Beni gravati da ipoteche",
  "regola" : "BENI_GRVTI_IPTCHE",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 8351,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Sistema",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        entita: Entita.POSIZIONE\r\n    \t    ], [\r\n    \t        nome: 'intestazionePosizione',\r\n    \t        descrizione: 'Nominativo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'codicePratica',\r\n    \t        descrizione: 'Posizione Syges3',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'garanzia_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        entita: Entita.GARANZIA\r\n    \t    ], [\r\n    \t        nome: 'codiceOriginario',\r\n    \t        descrizione: 'Identificativo garanzia',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'tipoGaranzia',\r\n    \t        descrizione: 'Tipo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'valoreNominale',\r\n    \t        descrizione: 'Importo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DECIMALE\r\n    \t    ], [\r\n    \t        nome: 'garante_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'garante',\r\n    \t        descrizione: 'Garante',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'grado',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'quota',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'immobile_codiceIdentificativo',\r\n    \t        descrizione: 'Identificativo bene',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'Id_Referente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n               nome: 'Id_Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n           ],  [\r\n               nome: 'Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ]\r\n\t    ]\r\n\t}\r\n\r\n\tpublic Collection<?> getData() {\r\n        entityManager.createQuery(\"\"\"\r\n            select distinct new Map(\r\n(cast(p.id as string) + '-' +coalesce(cast(pi.quotaPossesso * 100 as string) || '%', pi.quotaPossessoFrazionaria) + '-' + coalesce(i.codiceIdentificativo,cast(i.id as string))) \r\nas key,\r\n                p.id as posizione_id,\r\n                p.intestazione as intestazionePosizione,\r\n                p.ndgControparte as ndg,\r\n                p.codicePratica as codicePratica,\r\n                g.id as garanzia_id,\r\n                g.codiceOriginario as codiceOriginario,\r\n                t.descrizione as tipoGaranzia,\r\n                g.valoreNominale as valoreNominale,\r\n                sa.id as garante_id,\r\n                sa.nomeCompleto as garante,\r\n                gipi.grado as grado,\r\n                coalesce(cast(pi.quotaPossesso * 100 as string) || '%', pi.quotaPossessoFrazionaria) as quota,\r\n                coalesce(cast(i.codiceIdentificativo as string), cast(i.id as string)) as immobile_codiceIdentificativo,\r\n                \r\n                eor.nomeCompleto as                         NomeReferente_Pratica,\r\n                eor.id as                                   Id_Referente_Pratica,\r\n                sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \tsbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n                \r\n            )\r\n            from\r\n                Posizione p, StoricoReferenteEntita sre, StoricoPersona sp\r\n                join p.garanzie g\r\n                join g.tipoGaranzia t\r\n                join g.garanzie_SoggettiAnagrafici gsa\r\n                join gsa.soggettoAnagrafico sa\r\n                join g.garanzieIpotecarie_ProprietaImmobili gipi\r\n                join gipi.proprietaImmobile pi\r\n                join pi.datiImmobile i\r\n                \r\n                join p.infoEntita ie\r\n                join sre.ruoloReferenteEntita rre\r\n                join sre.elementoOrganizzativoReferente eor\r\n                \r\n                left join   sp.storicoBusinessUnit                      sbu\r\n                left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                \r\n                \r\n                where   sre.infoEntita.id = p.infoEntita.id\r\n                        and sre.corrente = true\r\n                        and rre.descrizione = 'Referente'\r\n                        \r\n                        and sso.corrente = true\r\n            \t\t\tand sp.elementoOrganizzativo.id = sre.elementoOrganizzativoReferente.id\r\n                \r\n                \"\"\")\r\n            .resultList\r\n            \r\n            //(cast(p.codicePratica as string) + '-' +cast (p.codiceIstituto as string) +'-'+p.ndgControparte) as key,\r\n\t}\r\n}\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 8351,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "BENI_GRVTI_IPTCHE",
      "descrizione" : "Beni gravati da ipoteche",
      "templateTestoRegola" : null,
      "oggetto_id" : 8351,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 25,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Beni gravati da ipoteche",
    "dataUltimoAggiornamentoDati" : 1552807156328,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "grado",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 609,
      "nomeFisico" : "grado_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : "POSIZIONE",
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 610,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "garante_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 611,
      "nomeFisico" : "garante_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Nominativo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 25,
      "nome" : "intestazionePosizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 612,
      "nomeFisico" : "intestazionePosizione_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 613,
      "nomeFisico" : "key_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Posizione Syges3",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "codicePratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 614,
      "nomeFisico" : "codicePratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "CodiceReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 839,
      "nomeFisico" : "CodiceReferente_Pratica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "quota",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 616,
      "nomeFisico" : "quota_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 840,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 25,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 617,
      "nomeFisico" : "ndg_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 841,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Tipo",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "tipoGaranzia",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 618,
      "nomeFisico" : "tipoGaranzia_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 842,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : "GARANZIA",
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "garanzia_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 619,
      "nomeFisico" : "garanzia_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Garante",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "garante",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 620,
      "nomeFisico" : "garante_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Identificativo bene",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "immobile_codiceIdentificativo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 621,
      "nomeFisico" : "immobile_codiceIdentificativo_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Importo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DECIMALE",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "valoreNominale",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 622,
      "nomeFisico" : "valoreNominale_d"
    }, {
      "multivalore" : null,
      "descrizione" : "Identificativo garanzia",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 25,
      "nome" : "codiceOriginario",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 623,
      "nomeFisico" : "codiceOriginario_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 613
  }
}, {
  "nome" : "Posizioni (Cedacri)",
  "regola" : "PSZNI_CDCRI",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 8352,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Sistema",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        entita: Entita.POSIZIONE\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        descrizione: 'Nominativo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'codicePratica',\r\n    \t        descrizione: 'Posizione Syges3',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'codiceIstituto',\r\n    \t        descrizione: 'Codice istituto',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'classificazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataApertura',\r\n    \t        descrizione: 'Data inizio',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'dataSofferenza',\r\n    \t        descrizione: 'Data inizio sofferenza',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'dataChiusura',\r\n    \t        descrizione: 'Data chiusura',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'stato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'filiale_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'filiale_nomeCompleto',\r\n    \t        descrizione: 'Filiale',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'garanziePersonali',\r\n    \t        descrizione: 'Garanzie personali',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.BOOLEANO,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'garanzieReali',\r\n    \t        descrizione: 'Garanzie reali',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.BOOLEANO,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'idReferente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeReferente',\r\n    \t        descrizione: 'Referente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataAssegnazioneReferente',\r\n    \t        descrizione: 'Data assegnazione referente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'idLegaleEsterno',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeLegaleEsterno',\r\n    \t        descrizione: 'Legale Esterno',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataAssegnazioneLegaleEsterno',\r\n    \t        descrizione: 'Data assegnazione legale',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'idUfficioRecuperoEsternalizzato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeUfficioRecuperoEsternalizzato',\r\n    \t        descrizione: 'Uff. Rec. Esternalizzato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataAssegnazioneUfficioRecuperoEsternalizzato',\r\n    \t        descrizione: 'Data assegnazione Uff. Rec. Est.',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'saldo',\r\n    \t        descrizione: 'Credito lordo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DECIMALE\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],   [\r\n               nome: 'Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ]\r\n\t    ]\r\n\t}\r\n\t\t\t\r\n\tpublic Collection<?> getData() {\r\n        // recupero i referenti dei tipi previsti raggruppandoli per posizione\r\n        def referenti = entityManager.createQuery(\"\"\"\r\n            select new Map(\r\n                ie.idEntita as posizione_id,\r\n                sre.dataInizioValidita as dataInizioValidita,\r\n                eor.id as elementoOrganizzativoReferente_id,\r\n                eor.nomeCompleto as elementoOrganizzativoReferente_nomeCompleto,\r\n                rre.descrizione as ruolo,\r\n                \r\n                eor.nomeCompleto as                         NomeReferente_Pratica,\r\n                eor.id as                                   Id_Referente_Pratica,\r\n                sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \tsbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n                \r\n            )\r\n            from\r\n                StoricoReferenteEntita sre, Posizione p, StoricoPersona sp\r\n                join sre.infoEntita ie\r\n                join sre.elementoOrganizzativoReferente eor\r\n                join sre.ruoloReferenteEntita rre\r\n                \r\n                left join   sp.storicoBusinessUnit                      sbu\r\n                left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                \r\n            where\r\n                ie.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                and ie.idEntita = p.id\r\n                and sre.corrente = true\r\n                and rre.descrizione in ('Referente','Legale Esterno')\r\n                and p.dataChiusura is null\r\n                \r\n                and sp.elementoOrganizzativo.id = sre.elementoOrganizzativoReferente.id\r\n                \r\n                \"\"\")\r\n            .resultList\r\n            .groupBy {\r\n                it.posizione_id\r\n            }\r\n\r\n        // recupero i dati di posizione\r\n        def data = entityManager.createQuery(\"\"\"\r\n            select new Map(\r\n                p.id as id,\r\n                p.intestazione as intestazione,\r\n                p.ndgControparte as ndg,\r\n                p.codicePratica as codicePratica,\r\n                case when p.tipologiaPosizione = it.sydema.laweb.domain.Enums\\$TipologiaPosizione.SOFFERENZA \r\n                    then 'Sofferenza' else 'Incaglio' end as classificazione,\r\n                p.dataApertura as dataApertura,\r\n                p.dataSofferenza as dataSofferenza,\r\n                p.dataChiusura as dataChiusura,\r\n                p.codiceIstituto as codiceIstituto,\r\n                case when p.dataChiusura is not null then 'Chiusa' else 'Aperta' end as stato,\r\n                f.id as filiale_id,\r\n                f.nomeCompleto as filiale_nomeCompleto,\r\n                case when exists (select g from p.garanzie g \r\n                        where g.tipoGaranzia.classeGaranzia = it.sydema.laweb.domain.Enums\\$ClasseGaranzia.PERSONALE)\r\n                    then true else false end as garanziePersonali,\r\n                case when exists (select g from p.garanzie g \r\n                        where g.tipoGaranzia.classeGaranzia in (\r\n                            it.sydema.laweb.domain.Enums\\$ClasseGaranzia.IPOTECARIA,\r\n                            it.sydema.laweb.domain.Enums\\$ClasseGaranzia.PIGNORATIZIA))\r\n                    then true else false end as garanzieReali\r\n            )\r\n            from\r\n                Posizione p\r\n                left join p.elementoOrganizzativoFilialePrevalente f\r\n                \r\n                \r\n                \r\n                \"\"\")\r\n            .resultList\r\n        \r\n        def saldi = [ : ]\r\n\r\n        def lts = context.getBean(ListaTemporaneaService.class)\r\n        def guid = lts.writeIdList(data.collect { it.id })\r\n\r\n        try {\r\n            // recupero i saldi\r\n            saldi = context.getBean(PosizioneSygesRepository.class)\r\n                .saldoPosizioni(guid as String)\r\n                .collectEntries {\r\n                    [ it.id, it.saldo ]\r\n                }\r\n        }\r\n        finally {\r\n            lts.delete(guid)\r\n        }\r\n        \r\n        data.collect { p ->\r\n            // integro i dati (referenti, saldi)\r\n            referenti[p.id]?.each {\r\n                def r = it.ruolo.replaceAll(' ', '')\r\n                \r\n                p[\"dataAssegnazione$r\"] = it.dataInizioValidita\r\n                p[\"id$r\"] = it.elementoOrganizzativoReferente_id\r\n                p[\"nome$r\"] = it.elementoOrganizzativoReferente_nomeCompleto\r\n                p.Ufficio = it.Ufficio \r\n            }\r\n            \r\n            p['saldo'] = saldi[p.id]\r\n        \r\n            p\r\n        }\r\n\t}\r\n}\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 8352,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PSZNI_CDCRI",
      "descrizione" : "Posizioni (Cedacri)",
      "templateTestoRegola" : null,
      "oggetto_id" : 8352,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 26,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Posizioni (Cedacri)",
    "dataUltimoAggiornamentoDati" : 1552807193102,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : "Credito lordo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DECIMALE",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "saldo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 640,
      "nomeFisico" : "saldo_d"
    }, {
      "multivalore" : null,
      "descrizione" : "Nominativo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 26,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 641,
      "nomeFisico" : "intestazione_t"
    }, {
      "multivalore" : null,
      "descrizione" : "Filiale",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "filiale_nomeCompleto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 642,
      "nomeFisico" : "filiale_nomeCompleto_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Garanzie personali",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "BOOLEANO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "garanziePersonali",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 643,
      "nomeFisico" : "garanziePersonali_b"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : "POSIZIONE",
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 644,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "filiale_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 645,
      "nomeFisico" : "filiale_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 843,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Referente",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "nomeReferente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 813,
      "nomeFisico" : "nomeReferente_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Legale Esterno",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "nomeLegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 814,
      "nomeFisico" : "nomeLegaleEsterno_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "idReferente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 815,
      "nomeFisico" : "idReferente_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Data chiusura",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "dataChiusura",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 624,
      "nomeFisico" : "dataChiusura_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "idLegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 816,
      "nomeFisico" : "idLegaleEsterno_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Data inizio sofferenza",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "dataSofferenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 625,
      "nomeFisico" : "dataSofferenza_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Data assegnazione legale",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "dataAssegnazioneLegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 817,
      "nomeFisico" : "dataAssegnazioneLegaleEsterno_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Data inizio",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "dataApertura",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 626,
      "nomeFisico" : "dataApertura_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Data assegnazione referente",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "dataAssegnazioneReferente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 818,
      "nomeFisico" : "dataAssegnazioneReferente_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "stato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 627,
      "nomeFisico" : "stato_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Data assegnazione Uff. Rec. Est.",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "dataAssegnazioneUfficioRecuperoEsternalizzato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 628,
      "nomeFisico" : "dataAssegnazioneUfficioRecuperoEsternalizzato_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "classificazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 629,
      "nomeFisico" : "classificazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Posizione Syges3",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "codicePratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 631,
      "nomeFisico" : "codicePratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Codice istituto",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "codiceIstituto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 634,
      "nomeFisico" : "codiceIstituto_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Uff. Rec. Esternalizzato",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "nomeUfficioRecuperoEsternalizzato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 636,
      "nomeFisico" : "nomeUfficioRecuperoEsternalizzato_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "idUfficioRecuperoEsternalizzato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 637,
      "nomeFisico" : "idUfficioRecuperoEsternalizzato_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Garanzie reali",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "BOOLEANO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "garanzieReali",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 638,
      "nomeFisico" : "garanzieReali_b"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 26,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 639,
      "nomeFisico" : "ndg_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 26,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 959,
      "nomeFisico" : "NomeReferente_Pratica_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 644
  }
}, {
  "nome" : "Movimenti di fatturazione",
  "regola" : "MVMNTI_FTTRZNE",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 8353,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'statoMovimentoFatturazione',\r\n    \t        descrizione: 'Stato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'importo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DECIMALE\r\n    \t    ], [\r\n    \t        nome: 'data',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'descrizioneMovimento',\r\n    \t        descrizione: 'Descrizione Movimento',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoFornitore_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'elementoOrganizzativoFornitore_nomeCompleto',\r\n    \t        descrizione: 'Fornitore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoFornitore_classe',\r\n    \t        descrizione: 'Classe fornitore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione_intestazione',\r\n    \t        descrizione: 'Posizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'giorni',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ]\r\n\t    ]\r\n\t}\r\n\t\t\t\r\n\tpublic Collection<?> getData() {\r\n\r\n        entityManager.createQuery(\"\"\"\r\n            select new Map(\r\n                mf.id as id,\r\n                mf.statoMovimentoFatturazione as statoMovimentoFatturazione,\r\n                coalesce(mf.importoConfermato, mf.importoForzato, mf.importoCalcolato) as importo,\r\n                (select max(ssmf2.data) from mf.storiciStatiMovimentiFatturazioni ssmf2) as data,\r\n                mf.descrizioneVoce as descrizioneMovimento,\r\n                eof.id as elementoOrganizzativoFornitore_id,\r\n                eof.nomeCompleto as elementoOrganizzativoFornitore_nomeCompleto,\r\n                eof.classeElementoOrganizzativo as elementoOrganizzativoFornitore_classe,\r\n                p.id as posizione_id,\r\n                p.intestazione as posizione_intestazione,\r\n                day_diff((select max(ssmf2.data) from mf.storiciStatiMovimentiFatturazioni ssmf2), current_date()) as giorni\r\n            )\r\n            from\r\n                MovimentoFatturazione mf\r\n                join mf.elementoOrganizzativoFornitore eof\r\n                join mf.posizione p\"\"\")\r\n            .resultList\r\n    }\r\n\t\r\n}\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 8353,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "MVMNTI_FTTRZNE",
      "descrizione" : "Movimenti di fatturazione",
      "templateTestoRegola" : null,
      "oggetto_id" : 8353,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 27,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Movimenti di fatturazione",
    "dataUltimoAggiornamentoDati" : 1552807157241,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : "Descrizione Movimento",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "descrizioneMovimento",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 656,
      "nomeFisico" : "descrizioneMovimento_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Posizione",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 27,
      "nome" : "posizione_intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 657,
      "nomeFisico" : "posizione_intestazione_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 658,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DECIMALE",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "importo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 648,
      "nomeFisico" : "importo_d"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 649,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Fornitore",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "elementoOrganizzativoFornitore_nomeCompleto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 650,
      "nomeFisico" : "elementoOrganizzativoFornitore_nomeCompleto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 651,
      "nomeFisico" : "giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Classe fornitore",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "elementoOrganizzativoFornitore_classe",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 652,
      "nomeFisico" : "elementoOrganizzativoFornitore_classe_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "elementoOrganizzativoFornitore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 653,
      "nomeFisico" : "elementoOrganizzativoFornitore_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 654,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Stato",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 27,
      "nome" : "statoMovimentoFatturazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 655,
      "nomeFisico" : "statoMovimentoFatturazione_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 649
  }
}, {
  "nome" : "Fatture",
  "regola" : "FTTRE",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 8354,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'statoFattura',\r\n    \t        descrizione: 'Stato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'dataEmissione',\r\n    \t        descrizione: 'Data emissione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'codiceIdentificativo',\r\n    \t        descrizione: 'Codice',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'descrizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'dataStato',\r\n    \t        descrizione: 'Data stato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorniStato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'giorniCreazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoFornitore_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoFornitore_nomeCompleto',\r\n    \t        descrizione: 'Fornitore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoFornitore_classe',\r\n    \t        descrizione: 'Classe fornitore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'gestore_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        multivalore: true\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        multivalore: true,\r\n    \t        ricercaFullText: true\r\n    \t    ]\r\n\t    ]\r\n\t}\r\n\t\t\t\r\n\tpublic Collection<?> getData() {\r\n\t    // recupero posizioni e gestori collegati alle fatture\r\n\t    def map = entityManager.createQuery(\"\"\"\r\n            select distinct new Map(\r\n                f.id as fattura_id,\r\n                p.id as posizione_id,\r\n                p.intestazione as intestazione,\r\n                eor.id as gestore_id,\r\n                eor.nomeCompleto as referente_nomeCompleto\r\n            )\r\n            from\r\n                Fattura f\r\n                join f.lineeFatture lf\r\n                join lf.lineeFatture_MovimentiFatturazioni lfmf\r\n                join lfmf.movimentoFatturazione mf\r\n                join mf.posizione p\r\n                join p.infoEntita ie\r\n                join ie.storiciReferentiEntite sre\r\n                join sre.elementoOrganizzativoReferente eor\r\n                join sre.ruoloReferenteEntita rre\r\n            where\r\n                sre.corrente = true\r\n                and rre.descrizione = 'Referente'\"\"\")\r\n            .resultList\r\n            .groupBy {\r\n                it.fattura_id\r\n            }\r\n            .collectEntries { k, v ->\r\n                [ k, [\r\n                    gestore_id: v.collect { it.gestore_id },\r\n                    intestazione: v.collect { it.intestazione }\r\n                ] ]\r\n            }\r\n\t    \r\n        entityManager.createQuery(\"\"\"\r\n            select new Map(\r\n                f.id as id,\r\n                f.statoFattura as statoFattura,\r\n                f.dataEmissione as dataEmissione,\r\n                f.codiceIdentificativo as codiceIdentificativo,\r\n                f.descrizione as descrizione,\r\n                (select max(ssf.data) from f.storiciStatiFatture ssf) as dataStato,\r\n                day_diff((select max(ssf.data) from f.storiciStatiFatture ssf), current_date()) as giorniStato,\r\n                day_diff(f.inseritoIl, current_date()) as giorniCreazione,\r\n                eof.id as elementoOrganizzativoFornitore_id,\r\n                eof.nomeCompleto as elementoOrganizzativoFornitore_nomeCompleto,\r\n                eof.classeElementoOrganizzativo as elementoOrganizzativoFornitore_classe\r\n            )\r\n            from\r\n                Fattura f\r\n                join f.elementoOrganizzativoFornitore eof\"\"\")\r\n            .resultList\r\n            .each {\r\n                it.putAll(map[it.id] ?: [ : ])\r\n            }\r\n\t}\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 8354,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "FTTRE",
      "descrizione" : "Fatture",
      "templateTestoRegola" : null,
      "oggetto_id" : 8354,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 28,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Fatture",
    "dataUltimoAggiornamentoDati" : 1552807208917,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : "Stato",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "statoFattura",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 787,
      "nomeFisico" : "statoFattura_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "giorniCreazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 788,
      "nomeFisico" : "giorniCreazione_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 28,
      "nome" : "descrizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 789,
      "nomeFisico" : "descrizione_t"
    }, {
      "multivalore" : null,
      "descrizione" : "Data stato",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "dataStato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 790,
      "nomeFisico" : "dataStato_dt"
    }, {
      "multivalore" : true,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 28,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 791,
      "nomeFisico" : "intestazione_tm"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "giorniStato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 792,
      "nomeFisico" : "giorniStato_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "elementoOrganizzativoFornitore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 793,
      "nomeFisico" : "elementoOrganizzativoFornitore_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Fornitore",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "elementoOrganizzativoFornitore_nomeCompleto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 794,
      "nomeFisico" : "elementoOrganizzativoFornitore_nomeCompleto_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Codice",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 28,
      "nome" : "codiceIdentificativo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 795,
      "nomeFisico" : "codiceIdentificativo_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 796,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Data emissione",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "dataEmissione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 797,
      "nomeFisico" : "dataEmissione_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Classe fornitore",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "elementoOrganizzativoFornitore_classe",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 798,
      "nomeFisico" : "elementoOrganizzativoFornitore_classe_s"
    }, {
      "multivalore" : true,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 28,
      "nome" : "gestore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 799,
      "nomeFisico" : "gestore_id_im"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 796
  }
}, {
  "nome" : "Alert generica processi (+15 giorni)",
  "regola" : "ALRT_GNRCA",
  "campoChiave" : "task_id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 10007,
    "descrizione" : "Generazione di un alert quando i giorni sono uguali a +15 (preavviso 10 giorni prima)",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\n\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'task_id' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'task',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'task_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'valoreAttributo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorni_inizio_notifica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n\t        ]\r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n            entityManager.createQuery(\"\"\"\r\n            select new Map(\r\n                p.id as posizione_id,\r\n                p.intestazione as posizione,\r\n                dt.nome as task,\r\n                dt.id as task_id,\r\n                ia.valoreData as valoreAttributo,\r\n                day_diff(ia.valoreData,current_date()) as giorni\r\n            )\r\n\t        from IstanzaAttributoTask ia, Posizione p\r\n    \t    left join ia.attributoProcesso ap\r\n    \t    left join ia.istanzaTask it\r\n    \t    left join it.istanzaProcesso ip\r\n    \t    left join ip.entiteProcessi ep\r\n    \t    left join it.definizioneTask dt\r\n    \t    where it.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.CONCLUSO\r\n    \t    and ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n    \t    and ep.idEntita = p.id\r\n    \t    and (ap.codice = 'DATA_NTFCA_INTRMDRI_FNNZRI_CUI_SI_CHDE_ESTNSNE_ACCRDO' or ap.codice = 'DATA_PBBLCZNE_ACCRDO_RGSTRO_IMPRSE'\r\n    \t        or ap.codice = 'DATA_INZO_DCRRNZA_TRMNI' or ap.codice = 'DATA_INZO_DCRRNZA_TRMNI')\r\n    \t    order by coalesce(it.dataChiusura, it.dataCreazione) desc\"\"\").resultList\r\n        }\r\n    }",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 10007,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "ALRT_GNRCA",
      "descrizione" : "Alert generica (+15 giorni)",
      "templateTestoRegola" : null,
      "oggetto_id" : 10007,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 29,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Alert generica processi (+15 giorni)",
    "dataUltimoAggiornamentoDati" : 1552807208839,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 29,
      "nome" : "valoreAttributo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 675,
      "nomeFisico" : "valoreAttributo_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 29,
      "nome" : "task_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 676,
      "nomeFisico" : "task_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 29,
      "nome" : "task",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 677,
      "nomeFisico" : "task_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 29,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 678,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 29,
      "nome" : "posizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 679,
      "nomeFisico" : "posizione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 29,
      "nome" : "giorni_inizio_notifica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 680,
      "nomeFisico" : "giorni_inizio_notifica_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 676
  }
}, {
  "nome" : "Alert generica processi (+7 giorni)",
  "regola" : "ALRT_GNRCA_7_GRNI",
  "campoChiave" : "task_id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 10017,
    "descrizione" : "Generazione di un alert quando i giorni sono uguali a +7 (preavviso 3 giorni prima)",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\n\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'task_id' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'task',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'task_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'valoreAttributo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorni_inizio_notifica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n\t        ]\r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n            entityManager.createQuery(\"\"\"\r\n            select new Map(\r\n                p.id as posizione_id,\r\n                p.intestazione as posizione,\r\n                dt.nome as task,\r\n                dt.id as task_id,\r\n                ia.valoreData as valoreAttributo,\r\n                day_diff(ia.valoreData,current_date()) as giorni\r\n            )\r\n\t        from IstanzaAttributoTask ia, Posizione p\r\n    \t    left join ia.attributoProcesso ap\r\n    \t    left join ia.istanzaTask it\r\n    \t    left join it.istanzaProcesso ip\r\n    \t    left join ip.entiteProcessi ep\r\n    \t    left join it.definizioneTask dt\r\n    \t    where it.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.CONCLUSO\r\n    \t    and ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n    \t    and ep.idEntita = p.id\r\n    \t    and (ap.codice = 'DATA_RCZNE_CMNCZNE' or ap.codice = 'DATA_PSSGGO_GDCTO')\r\n    \t    order by coalesce(it.dataChiusura, it.dataCreazione) desc\"\"\").resultList\r\n        }\r\n    }",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 10017,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "ALRT_GNRCA_7_GRNI",
      "descrizione" : "Alert generica (+ 7 giorni)",
      "templateTestoRegola" : null,
      "oggetto_id" : 10017,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 30,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Alert generica processi (+7 giorni)",
    "dataUltimoAggiornamentoDati" : 1552807211533,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 30,
      "nome" : "valoreAttributo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 681,
      "nomeFisico" : "valoreAttributo_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 30,
      "nome" : "task_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 682,
      "nomeFisico" : "task_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 30,
      "nome" : "task",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 683,
      "nomeFisico" : "task_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 30,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 684,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 30,
      "nome" : "posizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 685,
      "nomeFisico" : "posizione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 30,
      "nome" : "giorni_inizio_notifica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 686,
      "nomeFisico" : "giorni_inizio_notifica_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 682
  }
}, {
  "nome" : "Posizioni non assegnate al gestore",
  "regola" : "PSZNI_NON_ASSGNTE_GSTRE",
  "campoChiave" : "visualizzatoreKey",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 12441,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\ndef posizioni = entityManager.createQuery(\"\"\"select distinct\r\n    new Map(\r\n        p.id as id,\r\n        p.intestazione as intestazione,\r\n        p.ndgControparte as ndg,\r\n\t\teoUtente.id as idVisualizzatore\r\n    )\r\n    from\r\n        Posizione p, ElementoOrganizzativo eoUtente\r\n        where p.dataChiusura is null\r\n        and p.id not in \r\n        (\r\n            select distinct\r\n            p2.id as id\r\n        from InfoEntita ie2, Posizione p2\r\n            left join p2.elementoOrganizzativoMandante eo2\r\n            left join ie2.storiciReferentiEntite sre2 with sre2.corrente = true\r\n            join sre2.ruoloReferenteEntita rre2 with rre2.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n            where\r\n            p2.id = ie2.idEntita\r\n            and ie2.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n        )\r\n        and eoUtente.id in (81948, 82138, 82139, 82153, 82076)\r\n        order by p.id\r\n        \"\"\")\r\n    .resultList\r\n    .each \r\n    { \r\n        item ->\r\n        item['visualizzatoreKey'] = item.id + '-' + item.idVisualizzatore\r\n    }\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'visualizzatoreKey' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n\t    [       \r\n\t        [   \r\n            \tnome: 'id',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'ndg',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'intestazione',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'idVisualizzatore',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'visualizzatoreKey',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ]\r\n    \t ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        posizioni\r\n\t}\r\n}\r\n\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 12441,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PSZNI_NON_ASSGNTE_GSTRE",
      "descrizione" : "Posizioni non assegnate al gestore",
      "templateTestoRegola" : null,
      "oggetto_id" : 12441,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 31,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Posizioni non assegnate al gestore",
    "dataUltimoAggiornamentoDati" : 1552807209540,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 31,
      "nome" : "visualizzatoreKey",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 689,
      "nomeFisico" : "visualizzatoreKey_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 31,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 690,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 31,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 691,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 31,
      "nome" : "idVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 692,
      "nomeFisico" : "idVisualizzatore_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 31,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 693,
      "nomeFisico" : "id_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 689
  }
}, {
  "nome" : "Processi avviati",
  "regola" : "PRCSSI_AVVTI",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 12462,
    "descrizione" : "Estrazione processi avviati",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() { \r\n\t           [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'processo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'idTaskOrigine',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t    ],  [\r\n    \t        nome: 'idTaskAttivo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t    ], [\r\n    \t        nome: 'nomeTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t    ],  [\r\n    \t        nome: 'data',\r\n    \t        desrizione: \"Data avvio processo\",\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorni',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'idUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'ruoloIns',\r\n    \t        desrizione: \"Ruolo utente inserimento\",\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'descrizioneRuolo',\r\n    \t        desrizione: \"Descrizione Ruolo utente inserimento\",\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'gruppoEOIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'referenteAttualeInserimento',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'idElemorg_Vis',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'Referente',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'Ufficio',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'Id_Ufficio',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ]\r\n\t    ]}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n\r\n        def id_Elemorg = entityManager.createQuery(\"\"\"\r\n            select distinct new Map(\r\n            \teo.id as idElemorg_Vis\r\n            )\r\n            from RuoloReferenteEntita rre\r\n            join rre.storiciReferentiEntite sre\r\n            join sre.elementoOrganizzativoReferente eo\r\n            where sre.corrente = true\r\n                and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n            \"\"\").resultList \r\n\r\n        def var = entityManager.createQuery(\"\"\"select\r\n            new Map(\r\n                p.id as posizione_id,\r\n                p.intestazione as intestazionePosizione,\r\n                eo.id as idEo,\r\n                eo.nomeCompleto as proprietario,\r\n                sre.dataInizioValidita as dataInizioValidita,\r\n                min(rre.descrizione) as descRre\r\n                \r\n            )\r\n            from\r\n                Posizione p\r\n                join p.infoEntita ie\r\n                join ie.storiciReferentiEntite sre\r\n                join sre.ruoloReferenteEntita rre\r\n                join sre.elementoOrganizzativoReferente eo\r\n            where rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n            and sre.corrente = true\r\n            group by p.id, p.intestazione, eo.id, eo.nomeCompleto, sre.dataInizioValidita\r\n            \r\n            \"\"\").resultList\r\n\r\n        def index = 0\r\n        def map = []\r\n        var.each{it->\r\n            id_Elemorg.each{it2->\r\n                def copy = [:]\r\n                copy.putAll(it)\r\n                copy.putAll(it2)\r\n                copy.indice = index++\r\n                map << copy\r\n            }\r\n        }\r\n        \r\n        def processiAttivi = []\r\n        def index2 = 0\r\n    \r\n        def processiAvviati = entityManager.createQuery(\"\"\"select   distinct new Map(\r\n                                        ep.idEntita as posizione_id,\r\n                                        p.ndgControparte as ndg,\r\n                                        p.intestazione as intestazione,\r\n                                        ip.id as id,\r\n                                        dp.nome as processo,\r\n                                        it.id as idTaskOrigine,\r\n                                        it2.id as idTaskAttivo,\r\n                                        dt.nome as nomeTask,\r\n                                        ip.dataCreazione as data,\r\n                                        day_diff(ip.dataCreazione, current_date()) as giorni,\r\n                                        ip.inseritoDa as idUtenteIns,\r\n                                        eo.nomeCompleto as nomeUtenteIns,\r\n                                        rre.classeElementoOrganizzativo as ruoloIns,\r\n                                        geo.descrizione as gruppoEOIns,\r\n                                        coalesce(sre.corrente, '') as referenteAttualeInserimento,\r\n                                        min(rre.descrizione) as descrizioneRuolo,\r\n                                        \r\n            \t\t\t                sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \t\t\t                sbu.nomeCompleto as \t\t\t\t\t\tUfficio,\r\n                            \t\t\teor.nomeCompleto as                         NomeReferente_Pratica,\r\n                                        eor.id as                                   IdReferente_Pratica\r\n                            \t\t\t\r\n                                )\r\n                                from\r\n                                    IstanzaProcesso ip, Posizione p, StoricoPersona sp\r\n                                    join ip.istanzeTasks it\r\n                                    join ip.istanzeTasks it2 with it2.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.ATTIVO\r\n                                    join ip.entiteProcessi ep with ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                                    join ip.definizioneProcesso dp\r\n                                    join it2.definizioneTask dt\r\n                                    join it.utenteEsecutore u\r\n            \t\t\t\t\t\tjoin u.elementoOrganizzativo eo\r\n            \t\t\t\t\t\tleft join eo.referentiStoriciReferentiEntite sre\r\n            \t\t\t\t\t\tleft join sre.ruoloReferenteEntita rre\r\n            \t\t\t\t\t\tleft join eo.gruppiElementiOrganizzativi_ElementiOrganizzativi geo_eo\r\n                                    left join geo_eo.gruppoElementiOrganizzativi geo\r\n                                    \r\n                                    left join   sp.storicoBusinessUnit                      sbu\r\n                                    left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                                    join p.infoEntita                                       ie\r\n                                    join sre.ruoloReferenteEntita                           rre\r\n                                    join sre.elementoOrganizzativoReferente                 eor\r\n                                    \r\n        \t\t\t\t\t\twhere\r\n                                    ip.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.ATTIVO\r\n                                    and it.istanzaTaskOrigine is null\r\n                                    and p.id = ep.idEntita\r\n                                    and sre.corrente = true \r\n                                    \r\n                                    and u.elementoOrganizzativo.id = sbu.elementoOrganizzativo.id\r\n                                    and sso.corrente = true\r\n                                    and sre.infoEntita.id = p.infoEntita.id\r\n                                    and sre.corrente = true\r\n                                    and rre.descrizione = 'Referente'\r\n                                    \r\n                         \r\n                                    \r\n                                    group by \r\n                                    ip.id , ip.inseritoDa , ep.idEntita , p.ndgControparte , p.intestazione , dp.nome , it.id , it2.id , dt.nome , ip.dataCreazione, day_diff(ip.dataCreazione, current_date()) , eo.nomeCompleto , rre.classeElementoOrganizzativo, geo.descrizione, coalesce(sre.corrente, '')\r\n                            , sbu.nomeCompleto, sbu.elementoOrganizzativo.id, eor.nomeCompleto, eor.id      \r\n                                \"\"\").resultList\r\n                                \r\n        processiAttivi.each{it->\r\n            map.each{it2->\r\n                if(!it2.posizione_id || it.posizione_id.equals(it2.posizione_id)){\r\n                    def copy = [:]\r\n                    copy.putAll(it)\r\n                    copy.putAll(it2)\r\n                    copy.id = index2++\r\n                    processiAttivi << copy\r\n                }\r\n            }\r\n        }\r\n        \r\n        processiAttivi\r\n\t}\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 12462,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PRCSSI_AVVTI",
      "descrizione" : "Processi avviati",
      "templateTestoRegola" : null,
      "oggetto_id" : 12462,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 32,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Processi avviati",
    "dataUltimoAggiornamentoDati" : 1552805888779,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "idElemorg_Vis",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 704,
      "nomeFisico" : "idElemorg_Vis_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "idTaskAttivo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 705,
      "nomeFisico" : "idTaskAttivo_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "idTaskOrigine",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 706,
      "nomeFisico" : "idTaskOrigine_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "idUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 707,
      "nomeFisico" : "idUtenteIns_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 708,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 709,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "CodiceReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 933,
      "nomeFisico" : "CodiceReferente_Pratica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "nomeTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 710,
      "nomeFisico" : "nomeTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 934,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "Id_Referente_Wf",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 848,
      "nomeFisico" : "Id_Referente_Wf_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 849,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "Referente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 850,
      "nomeFisico" : "Referente_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "Referente_Wf",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 851,
      "nomeFisico" : "Referente_Wf_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 852,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "ruoloIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 694,
      "nomeFisico" : "ruoloIns_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "referenteAttualeInserimento",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 695,
      "nomeFisico" : "referenteAttualeInserimento_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 32,
      "nome" : "processo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 696,
      "nomeFisico" : "processo_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 697,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "nomeUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 698,
      "nomeFisico" : "nomeUtenteIns_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 699,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "descrizioneRuolo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 700,
      "nomeFisico" : "descrizioneRuolo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 701,
      "nomeFisico" : "giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "gruppoEOIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 702,
      "nomeFisico" : "gruppoEOIns_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 32,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 703,
      "nomeFisico" : "id_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 703
  }
}, {
  "nome" : "Processi avviati da Gestore",
  "regola" : "PRCSSI_AVVTI_GSTRE",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 12464,
    "descrizione" : "Processi avviati da Gestore",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() { \r\n\t           [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'processo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'idTaskOrigine',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t    ],  [\r\n    \t        nome: 'idTaskAttivo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t    ], [\r\n    \t        nome: 'nomeTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t    ],  [\r\n    \t        nome: 'data',\r\n    \t        desrizione: \"Data avvio processo\",\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorni',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'idUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'idEo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n               nome: 'Id_Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n           ],  [\r\n               nome: 'Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ]\r\n\t    ]}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n\r\n      def utentiSLE = entityManager.createQuery(\"\"\"select\r\n            new Map(\r\n                p.id as posizione_id,\r\n                p.intestazione as intestazionePosizione,\r\n                \r\n                eo.nomeCompleto as proprietario,\r\n                sre.dataInizioValidita as dataInizioValidita,\r\n                min(rre.descrizione) as descRre\r\n                \r\n            )\r\n            from\r\n                Posizione p\r\n                join p.infoEntita ie\r\n                join ie.storiciReferentiEntite sre\r\n                join sre.ruoloReferenteEntita rre\r\n                join sre.elementoOrganizzativoReferente eo\r\n            where rre.classeElementoOrganizzativo = it.sydema.laweb.domain.Enums\\$ClasseElementoOrganizzativo.SLE\r\n            and sre.corrente = true\r\n            group by p.id, p.intestazione, eo.id, eo.nomeCompleto, sre.dataInizioValidita\r\n            \r\n            \"\"\").resultList\r\n  \r\n        def processiAttivi = []\r\n        def index2 = 0\r\n    \r\n        def processiAvviati =  entityManager.createQuery(\"\"\"select   distinct new Map(\r\n                                        ep.idEntita as posizione_id,\r\n                                        p.ndgControparte as ndg,\r\n                                        p.intestazione as intestazione,\r\n                                        ip.id as id,\r\n                                        dp.nome as processo,\r\n                                        it.id as idTaskOrigine,\r\n                                        it2.id as idTaskAttivo,\r\n                                        dt.nome as nomeTask,\r\n                                        ip.dataCreazione as data,\r\n                                        day_diff(ip.dataCreazione, current_date()) as giorni,\r\n                                        ip.inseritoDa as idUtenteIns,\r\n                                        eo.nomeCompleto as nomeUtenteIns,\r\n                                        eo.id as idEo,\r\n                                        \r\n                                        eor.nomeCompleto as                         NomeReferente_Pratica,\r\n                                        eor.id as                                   IdReferente_Pratica,\r\n                                        sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \t                        sbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n                                        \r\n                                )\r\n                                from\r\n                                    IstanzaProcesso ip, Posizione p, Utente u, StoricoPersona sp\r\n                                    join ip.istanzeTasks it\r\n                                    join ip.istanzeTasks it2 with it2.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.ATTIVO\r\n                                    join ip.entiteProcessi ep with ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                                    join ip.definizioneProcesso dp\r\n                                    join it2.definizioneTask dt\r\n                                    \r\n                                    join u.elementoOrganizzativo eo\r\n                                    join eo.referentiStoriciReferentiEntite sre\r\n            \t\t\t\t\t\tjoin sre.ruoloReferenteEntita rre\r\n            \t\t\t\t\t\t\r\n            \t\t\t\t\t\tjoin        sre.elementoOrganizzativoReferente eor\r\n            \t\t\t\t\t\tleft join   sp.storicoBusinessUnit                      sbu\r\n                                    left join   sbu.storicoStrutturaOrganizzativa           sso\r\n            \t\t\t\t\t\t\r\n            \t\t\t\t\t\t\r\n        \t\t\t\t\t\twhere\r\n        \t\t\t\t\t\t    ip.inseritoDa = u.id\r\n                                    and ip.statoIstanza = it.sydema.laweb.domain.Enums\\$StatoIstanza.ATTIVO\r\n                                    and it.istanzaTaskOrigine is null\r\n                                    and p.id = ep.idEntita\r\n                                    and sre.corrente = true\r\n                                    and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n                                    \r\n                                    and sso.corrente = true\r\n                                    and sp.elementoOrganizzativo.id = sre.elementoOrganizzativoReferente.id\r\n                                    \r\n                                    \r\n                                \"\"\").resultList.each{it->\r\n                                        \r\n                                        utentiSLE.each{it2->\r\n                                            if(!it2.posizione_id || it.posizione_id.equals(it2.posizione_id)){\r\n                                                def copy = [:]\r\n                                                copy.putAll(it)\r\n                                                copy.putAll(it2)\r\n                                                copy.id = index2++\r\n                                                processiAttivi << copy\r\n                                            }\r\n                                        }\r\n                                }\r\n        processiAttivi\r\n\t}\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 12464,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PRCSSI_AVVTI_GSTRE",
      "descrizione" : "Processi avviati da Gestore",
      "templateTestoRegola" : null,
      "oggetto_id" : 12464,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 33,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Processi avviati da Gestore",
    "dataUltimoAggiornamentoDati" : 1552805947268,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 33,
      "nome" : "processo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 711,
      "nomeFisico" : "processo_t"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 712,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 713,
      "nomeFisico" : "giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 714,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "idEo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 715,
      "nomeFisico" : "idEo_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "idTaskAttivo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 716,
      "nomeFisico" : "idTaskAttivo_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "idTaskOrigine",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 717,
      "nomeFisico" : "idTaskOrigine_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "idUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 718,
      "nomeFisico" : "idUtenteIns_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 719,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 720,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "nomeTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 721,
      "nomeFisico" : "nomeTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "nomeUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 722,
      "nomeFisico" : "nomeUtenteIns_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 723,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "IdReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 979,
      "nomeFisico" : "IdReferente_Pratica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 891,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 892,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 33,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 893,
      "nomeFisico" : "Id_Ufficio_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 714
  }
}, {
  "nome" : "Allegati inseriti sulla pratica",
  "regola" : "ALLGTI_INSRTI_PRTCA",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 12468,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n           [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'idDocumento',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'dataInserimento',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'descrizione',\r\n    \t        desrizione: \"Tipologia nota\",\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'cartella',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'percorso',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'idPosizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'idUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'idTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'task',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'processo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'nomeUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'idVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n               nome: 'Id_Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n           ],  [\r\n               nome: 'Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ]\r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n\r\n\t        def utenti = entityManager.createQuery(\"\"\"select distinct \r\n                        new Map (\r\n                            p.id as posizione_id,\r\n                            eo.id as idVisualizzatore\r\n                            ) \r\n                    from Posizione p\r\n                        join p.infoEntita ie\r\n                        join ie.storiciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo \r\n                    where sre.corrente = true\r\n                        and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n                        \r\n                \"\"\").resultList\r\n           \r\n            \r\n            def allegatiTot = []\r\n            def indiceNota = 0\r\n            def allegati = entityManager.createQuery(\"\"\"select distinct\r\n            \t\t        new Map(\r\n            \t\t        d.id as idDocumento,\r\n            \t\t        d.dataRegistrazione as dataInserimento,\r\n            \t\t        td.descrizione as descrizione,\r\n            \t\t        c.nome as cartella,\r\n            \t\t        \r\n            \t\t        ie.idEntita as idPosizione,\r\n            \t\t        p.intestazione as intestazione,\r\n            \t\t        d.inseritoDa as idUtenteIns,\r\n            \t\t        dt.id as idTask,\r\n            \t\t        coalesce(dt.nome, '') as task,\r\n            \t\t        coalesce(dp.nome, '') as processo,\r\n            \t\t        \r\n                            eo.nomeCompleto as nomeUtenteIns,\r\n                            \r\n                            eor.nomeCompleto as                         NomeReferente_Pratica,\r\n                            eor.id as                                   IdReferente_Pratica,\r\n                            sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \t            sbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n                            \r\n                            )\r\n        \t\t        from Posizione p, StoricoReferenteEntita sre, StoricoPersona sp\r\n        \t\t        join p.infoEntita ie\r\n                        join ie.documenti_InfiEntite die\r\n                        join die.documento d\r\n        \t\t            join die.cartella c\r\n        \t\t                left join c.cartellaContenitore c1\r\n            \t                left join c1.cartellaContenitore c2\r\n            \t                left join c2.cartellaContenitore c3\r\n        \t\t        join d.tipoDocumento td\r\n        \t\t        left join d.istanzeTasks it\r\n                        left join it.definizioneTask dt\r\n                        left join dt.definizioneProcesso dp\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo \r\n                        join eo.utente u\r\n                        \r\n                        join        sre.elementoOrganizzativoReferente          eor\r\n                        left join   sp.storicoBusinessUnit                      sbu\r\n                        left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                        \r\n                        \r\n                        where       sre.corrente = true\r\n                                    and u.id = d.inseritoDa\r\n                                    \r\n                                    and rre.descrizione = 'Referente'\r\n                                    and sso.corrente = true\r\n            \t\t\t            and sp.elementoOrganizzativo.id = sre.elementoOrganizzativoReferente.id\r\n                            \r\n        \t\t        \"\"\").resultList.each\r\n                            { it ->\r\n                                utenti.each\r\n                                { it2 ->\r\n                                    if(it2.posizione_id == it.idPosizione)\r\n                                    {\r\n                                        it['key'] = \"\"+it.idDocumento + \" - \" + it2.idVisualizzatore\r\n                                        def copy = [:]\r\n                                        copy.putAll(it)\r\n                                        copy.putAll(it2)\r\n                                        copy.id = indiceNota++\r\n                                        allegatiTot << copy\r\n                                    }\r\n                                }\r\n                            }\r\n            allegatiTot\r\n            \r\n\t}\r\n\t\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 12468,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "ALLGTI_INSRTI_PRTCA",
      "descrizione" : "Allegati inseriti sulla pratica",
      "templateTestoRegola" : null,
      "oggetto_id" : 12468,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 34,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Allegati inseriti sulla pratica",
    "dataUltimoAggiornamentoDati" : 1552805880230,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "nomeUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 736,
      "nomeFisico" : "nomeUtenteIns_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "percorso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 737,
      "nomeFisico" : "percorso_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "task",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 724,
      "nomeFisico" : "task_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 980,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "processo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 725,
      "nomeFisico" : "processo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 981,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "cartella",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 726,
      "nomeFisico" : "cartella_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 982,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "dataInserimento",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 727,
      "nomeFisico" : "dataInserimento_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "IdReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 983,
      "nomeFisico" : "IdReferente_Pratica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "descrizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 728,
      "nomeFisico" : "descrizione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "idDocumento",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 729,
      "nomeFisico" : "idDocumento_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "idPosizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 730,
      "nomeFisico" : "idPosizione_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "idTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 731,
      "nomeFisico" : "idTask_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "idUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 732,
      "nomeFisico" : "idUtenteIns_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "idVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 733,
      "nomeFisico" : "idVisualizzatore_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 734,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 34,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 735,
      "nomeFisico" : "key_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 735
  }
}, {
  "nome" : "Nuova nota proforma",
  "regola" : "FTTRE_ELBRTE_SLE_r1",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 12469,
    "descrizione" : "Creazione di una nota proforma (fattura) da parte del Legale",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n           [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'fattura_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'dataEmissione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'statoFattura',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'codiceIdentificativo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'descrizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'dataStato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'elementoOrganizzativoFornitore_nomeCompleto',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'elementoOrganizzativoFornitore_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'giorniStato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'giorniCreazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'elementoOrganizzativoFornitore_classe',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'nomeUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'idVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n               nome: 'Id_Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n           ],  [\r\n               nome: 'Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ]\r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n\r\n        def utenti = entityManager.createQuery(\"\"\"select distinct \r\n                        new Map (\r\n                            p.id as posizione_id,\r\n                            eo.id as idVisualizzatore\r\n                            ) \r\n                    from Posizione p\r\n                        join p.infoEntita ie\r\n                        join ie.storiciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo \r\n                    where sre.corrente = true\r\n                        and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n                        \r\n                \"\"\").resultList\r\n        \r\n        def noteDaSLE = []\r\n        def indiceNota = 0\r\n        entityManager.createQuery(\"\"\"\r\n            select distinct new Map(\r\n                f.id as fattura_id,\r\n                f.statoFattura as statoFattura,\r\n                f.dataEmissione as dataEmissione,\r\n                f.codiceIdentificativo as codiceIdentificativo,\r\n                f.descrizione as descrizione,\r\n                (select max(ssf.data) from f.storiciStatiFatture ssf) as dataStato,\r\n                day_diff((select max(ssf.data) from f.storiciStatiFatture ssf), current_date()) as giorniStato,\r\n                day_diff(f.inseritoIl, current_date()) as giorniCreazione,\r\n                eof.id as elementoOrganizzativoFornitore_id,\r\n                eof.nomeCompleto as elementoOrganizzativoFornitore_nomeCompleto,\r\n                eof.classeElementoOrganizzativo as elementoOrganizzativoFornitore_classe,\r\n                p.id as posizione_id,\r\n                eo.nomeCompleto as nomeUtenteIns,\r\n                \r\n                eor.nomeCompleto as                         IdReferente_Pratica,\r\n                eor.id as                                   CodiceReferente_Pratica,\r\n                sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \tsbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n            )\r\n            from\r\n                Fattura f, StoricoReferenteEntita sre, StoricoPersona sp\r\n                join f.lineeFatture lf\r\n                join lf.lineeFatture_MovimentiFatturazioni lfmf\r\n                join lfmf.movimentoFatturazione mf\r\n                join mf.posizione p\r\n                join p.infoEntita ie\r\n                join f.elementoOrganizzativoFornitore eof\r\n                join sre.ruoloReferenteEntita rre with rre.classeElementoOrganizzativo =  it.sydema.laweb.domain.Enums\\$ClasseElementoOrganizzativo.SLE\r\n                join sre.elementoOrganizzativoReferente eo \r\n                join eo.utente u\r\n                \r\n                join    sre.ruoloReferenteEntita                        rre\r\n                join    sre.elementoOrganizzativoReferente              eor\r\n                left join   sp.storicoBusinessUnit                      sbu\r\n                left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                \r\n            where       sre.corrente = true\r\n                        and u.id = f.aggiornatoDa \r\n                        \r\n                        and sso.corrente = true\r\n                        and rre.descrizione = 'Referente'\r\n                        and sp.elementoOrganizzativo.id = sre.elementoOrganizzativoReferente.id\r\n                \r\n                \"\"\")\r\n            .resultList.each\r\n                { it ->\r\n                    utenti.each\r\n                    { it2 ->\r\n                        if(it2.posizione_id == it.posizione_id)\r\n                        {\r\n                            it['key'] = \"\"+it.fattura_id + \" - \" + it2.idVisualizzatore\r\n                            def copy = [:]\r\n                            copy.putAll(it)\r\n                            copy.putAll(it2)\r\n                            copy.id = indiceNota++\r\n                            noteDaSLE << copy\r\n                        }\r\n                    }\r\n                }\r\n            \r\n        noteDaSLE\r\n\r\n\t}\r\n\t\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 12469,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "FTTRE_ELBRTE_SLE_r1",
      "descrizione" : "Fatture elaborate da SLE",
      "templateTestoRegola" : null,
      "oggetto_id" : 12469,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 35,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Nuova nota proforma",
    "dataUltimoAggiornamentoDati" : 1552805880408,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 896,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 897,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "statoFattura",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 744,
      "nomeFisico" : "statoFattura_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 745,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "nomeUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 746,
      "nomeFisico" : "nomeUtenteIns_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "codiceIdentificativo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 747,
      "nomeFisico" : "codiceIdentificativo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "dataEmissione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 748,
      "nomeFisico" : "dataEmissione_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "dataStato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 749,
      "nomeFisico" : "dataStato_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "descrizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 750,
      "nomeFisico" : "descrizione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "elementoOrganizzativoFornitore_classe",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 751,
      "nomeFisico" : "elementoOrganizzativoFornitore_classe_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "elementoOrganizzativoFornitore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 752,
      "nomeFisico" : "elementoOrganizzativoFornitore_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "elementoOrganizzativoFornitore_nomeCompleto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 753,
      "nomeFisico" : "elementoOrganizzativoFornitore_nomeCompleto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "fattura_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 754,
      "nomeFisico" : "fattura_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "giorniCreazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 755,
      "nomeFisico" : "giorniCreazione_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "giorniStato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 756,
      "nomeFisico" : "giorniStato_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "idVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 757,
      "nomeFisico" : "idVisualizzatore_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 758,
      "nomeFisico" : "key_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "IdReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 984,
      "nomeFisico" : "IdReferente_Pratica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 35,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 895,
      "nomeFisico" : "Ufficio_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 758
  }
}, {
  "nome" : "Approvazione nota proforma",
  "regola" : "APPRVZNE_FTTRA",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 12470,
    "descrizione" : "Approvazione nota proforma",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n           [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'fattura_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'dataEmissione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'statoFattura',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'codiceIdentificativo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'descrizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],[\r\n    \t        nome: 'dataStato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ],  [\r\n    \t        nome: 'giorniStato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'giorniCreazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'nomeUtenteIns',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'posizione_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'idVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ]\r\n\t    ]\r\n\t}\r\n\t\r\n    public Collection<?> getData() {\r\n        \r\n        def referenti = entityManager.createQuery(\"\"\"select distinct \r\n                        new Map (\r\n                            p.id as posizione_id,\r\n                            eo.id as idVisualizzatore\r\n                            ) \r\n                    from Posizione p\r\n                        join p.infoEntita ie\r\n                        join ie.storiciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo\r\n                  where (\r\n                            rre.classeElementoOrganizzativo =  it.sydema.laweb.domain.Enums\\$ClasseElementoOrganizzativo.SLE\r\n                            or rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n                        )\r\n                        and sre.corrente = true\r\n                \"\"\").resultList\r\n                \r\n        \r\n        def referenti2 = []\r\n\r\n        def referentiBU = entityManager.createQuery(\"\"\"\r\n            select distinct new Map(\r\n            \teo.id as idVisualizzatore,\r\n            \teo.nomeCompleto as nome,\r\n            \tsbu.elementoOrganizzativo.id as sbuId,\r\n            \teor.id as gestoreId\r\n            )\r\n            from ElementoOrganizzativo eo, RuoloReferenteEntita rre\r\n            join eo.storiciPersone sp\r\n            join sp.storicoBusinessUnit sbu\r\n            join sbu.storicoStrutturaOrganizzativa sso\r\n            \r\n            join rre.storiciReferentiEntite sre\r\n            join sre.elementoOrganizzativoReferente eor\r\n            join eo.storiciPersone spr\r\n            join sp.storicoBusinessUnit sbur\r\n            where sre.corrente = true\r\n                and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n                and sso.corrente = true\r\n                and sbu.id = sbur.id\r\n            \"\"\").resultList \r\n        referenti.each\r\n        { referente ->\r\n            def presente = false\r\n            referentiBU.each\r\n            { referenteBusinessUnit ->\r\n                if(referente.idVisualizzatore == referenteBusinessUnit.gestoreId)\r\n                {\r\n                    presente = true\r\n                    def copy2 = [:]\r\n                    copy2.putAll(referente)\r\n                    copy2.idVisualizzatore = referenteBusinessUnit.idVisualizzatore\r\n                    copy2.nome = referenteBusinessUnit.nome\r\n                    referenti2 << copy2\r\n                }\r\n            }\r\n            if(presente == false)\r\n                referenti2 << referente\r\n            \r\n        }\r\n\r\n        def noteDaSLE = []\r\n        def indiceNota = 0\r\n        entityManager.createQuery(\"\"\"\r\n            select distinct new Map(\r\n                f.id as fattura_id,\r\n                f.statoFattura as statoFattura,\r\n                f.dataEmissione as dataEmissione,\r\n                f.codiceIdentificativo as codiceIdentificativo,\r\n                f.descrizione as descrizione,\r\n                (select max(ssf.data) from f.storiciStatiFatture ssf) as dataStato,\r\n                day_diff((select max(ssf.data) from f.storiciStatiFatture ssf), current_date()) as giorniStato,\r\n                day_diff(f.inseritoIl, current_date()) as giorniCreazione,\r\n                p.id as posizione_id,\r\n                eo.nomeCompleto as nomeUtenteIns\r\n            )\r\n            from\r\n                Fattura f, Utente u\r\n                join f.lineeFatture lf\r\n                join lf.lineeFatture_MovimentiFatturazioni lfmf\r\n                join lfmf.movimentoFatturazione mf\r\n                join mf.posizione p\r\n                join u.elementoOrganizzativo eo\r\n            where u.id = f.aggiornatoDa \r\n                \r\n                \"\"\")\r\n            .resultList.each\r\n                { it ->\r\n                    referenti2.each\r\n                    { it2 ->\r\n                        if(it2.posizione_id == it.posizione_id)\r\n                        {\r\n                            it['key'] = \"\"+it.fattura_id + \" - \" + it2.idVisualizzatore\r\n                            def copy = [:]\r\n                            copy.putAll(it)\r\n                            copy.putAll(it2)\r\n                            copy.id = indiceNota++\r\n                            noteDaSLE << copy\r\n                        }\r\n                    }\r\n                }\r\n            \r\n        noteDaSLE\r\n    }\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 12470,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "APPRVZNE_FTTRA",
      "descrizione" : "Approvazione della fattura",
      "templateTestoRegola" : null,
      "oggetto_id" : 12470,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 36,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Approvazione nota proforma",
    "dataUltimoAggiornamentoDati" : 1552806119710,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "dataStato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 768,
      "nomeFisico" : "dataStato_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "dataEmissione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 769,
      "nomeFisico" : "dataEmissione_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "codiceIdentificativo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 770,
      "nomeFisico" : "codiceIdentificativo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "statoFattura",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 759,
      "nomeFisico" : "statoFattura_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 760,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "nomeUtenteIns",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 761,
      "nomeFisico" : "nomeUtenteIns_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 762,
      "nomeFisico" : "key_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "idVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 763,
      "nomeFisico" : "idVisualizzatore_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "giorniStato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 764,
      "nomeFisico" : "giorniStato_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "giorniCreazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 765,
      "nomeFisico" : "giorniCreazione_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "fattura_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 766,
      "nomeFisico" : "fattura_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 36,
      "nome" : "descrizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 767,
      "nomeFisico" : "descrizione_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 762
  }
}, {
  "nome" : "Note inserite sulla pratica",
  "regola" : "NOTE_INSRTE_PRTCA",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 12471,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n           [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ],  [\r\n    \t        nome: 'idPosizione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'idNota',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'data',\r\n    \t        descrizione: 'Data inserimento',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ],  [\r\n    \t        nome: 'utenteInserimento',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'tipologiaNota',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'testo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'ruolo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'idVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'NomeReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n               nome: 'Id_Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n           ],  [\r\n               nome: 'Ufficio',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ]\r\n\t    \r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n\t    \r\n\t    def ref = 0\r\n\t    def sle = 0\r\n\t    def sre = 0\r\n\t    Calendar c = Calendar.getInstance();\r\n        c.add(Calendar.DAY_OF_YEAR, -5);\r\n        Date d = c.getTime();\r\n\t    \r\n\t    \r\n\t        def utentiSLE = entityManager.createQuery(\"\"\"select distinct \r\n                        new Map (\r\n                            p.id as posizione_id,\r\n                            eo.id as idVisualizzatore,\r\n                            rre.descrizione as ruolo\r\n                            ) \r\n                    from Posizione p\r\n                        join p.infoEntita ie\r\n                        join ie.storiciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo \r\n                    where rre.descrizione in ('SLE')\r\n                \"\"\").resultList\r\n           \r\n            def utentiSRE = entityManager.createQuery(\"\"\"select distinct \r\n                        new Map (\r\n                            p.id as posizione_id,\r\n                            eo.id as idVisualizzatore,\r\n                            rre.descrizione as ruolo\r\n                            ) \r\n                    from Posizione p\r\n                        join p.infoEntita ie\r\n                        join ie.storiciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo \r\n                    where rre.descrizione in ('SRE')\r\n                \"\"\").resultList\r\n           \r\n            def utentiReferente = entityManager.createQuery(\"\"\"select distinct \r\n                        new Map (\r\n                            p.id as posizione_id,\r\n                            eo.id as idVisualizzatore,\r\n                            rre.descrizione as ruolo\r\n                            ) \r\n                    from Posizione p\r\n                        join p.infoEntita ie\r\n                        join ie.storiciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        join sre.elementoOrganizzativoReferente eo \r\n                    where rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n                \"\"\").resultList\r\n              \r\n            \r\n            def annotazioni = []\r\n            def indiceNota = 0\r\n            def note = entityManager.createQuery(\"\"\"select distinct\r\n                    new Map(\r\n                            p.id as idPosizione,\r\n                            p.intestazione as intestazione,\r\n                            ne.id as idNota,\r\n                            ne.data as data,\r\n                            eo.nomeCompleto as utenteInserimento,\r\n                            tn.descrizione as tipologiaNota,\r\n                            tn.id as idTipologiaNota,\r\n                            coalesce(ne.testo,'') as testo,\r\n                            rre.classeElementoOrganizzativo as ruoloUtenteInserimento,\r\n                            \r\n                            eor.nomeCompleto as                         NomeReferente_Pratica,\r\n                            eor.id as                                   IdReferente_Pratica,\r\n                            sbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n            \t            sbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n                            \r\n                    )\r\n                    from Posizione p, StoricoPersona sp\r\n                        join p.infoEntita ie with ie.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                        join ie.noteEntite ne\r\n                        join ne.tipologiaNota tn\r\n                        join ne.elementoOrganizzativo eo\r\n                        join eo.referentiStoriciReferentiEntite sre\r\n                        join sre.ruoloReferenteEntita rre\r\n                        \r\n                        join        sre.elementoOrganizzativoReferente          eor\r\n                        left join   sp.storicoBusinessUnit                      sbu\r\n                        left join   sbu.storicoStrutturaOrganizzativa           sso\r\n                        \r\n                        \r\n                    where \r\n                        sre.corrente = 1\r\n                        and ne.data > :param\r\n                        \r\n                        \r\n                        and sso.corrente = true\r\n                        and rre.descrizione = 'Referente'\r\n                        and sp.elementoOrganizzativo.id = sre.elementoOrganizzativoReferente.id\r\n                        \r\n                        \r\n                        and tn.id in (5,6,1005,1007,1010,1011,1012,1013)\r\n                                \"\"\").setParameter(\"param\", d).resultList.each\r\n                                    { it ->//throw new Exception('aaaa')\r\n                                        def nota = it\r\n                                        \r\n                                        if(it.idTipologiaNota == 1005 || it.idTipologiaNota == 1013)\r\n                                        {\r\n                                            utentiSLE.each\r\n                                            { itSLE ->\r\n                                                if(itSLE.posizione_id == it.idPosizione)\r\n                                                {\r\n                                                    nota['key'] = \"\"+nota.idNota + \" - \" + itSLE.idVisualizzatore\r\n                                                    def copy = [:]\r\n                                                    copy.putAll(nota)\r\n                                                    copy.putAll(itSLE)\r\n                                                    copy.id = indiceNota++\r\n                                                    annotazioni << copy\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                        else if(it.idTipologiaNota == 1010 || it.idTipologiaNota == 1012)\r\n                                        {\r\n                                            utentiSRE.each\r\n                                            { itSRE ->\r\n                                                if(itSRE.posizione_id == it.idPosizione)\r\n                                                {\r\n                                                    nota['key'] = \"\"+nota.idNota + \" - \" + itSRE.idVisualizzatore\r\n                                                    def copy = [:]\r\n                                                    copy.putAll(nota)\r\n                                                    copy.putAll(itSRE)\r\n                                                    copy.id = indiceNota++\r\n                                                    annotazioni << copy\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                        else if(it.idTipologiaNota == 1007 || it.idTipologiaNota == 1011 || it.idTipologiaNota == 5 || it.idTipologiaNota == 6)\r\n                                        {\r\n                                            utentiReferente.each\r\n                                            { itRef ->\r\n                                                if(itRef.posizione_id == it.idPosizione)\r\n                                                {\r\n                                                    nota['key'] = \"\"+nota.idNota + \" - \" + itRef.idVisualizzatore\r\n                                                    def copy = [:]\r\n                                                    copy.putAll(nota)\r\n                                                    copy.putAll(itRef)\r\n                                                    copy.id = indiceNota++\r\n                                                    annotazioni << copy\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n            annotazioni\t\t\r\n        }\r\n    }\r\n\r\n",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 12471,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "NOTE_INSRTE_PRTCA",
      "descrizione" : "Note inserite sulla pratica",
      "templateTestoRegola" : null,
      "oggetto_id" : 12471,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 37,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Note inserite sulla pratica",
    "dataUltimoAggiornamentoDati" : 1552806120184,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "utenteInserimento",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 771,
      "nomeFisico" : "utenteInserimento_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "tipologiaNota",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 772,
      "nomeFisico" : "tipologiaNota_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "Id_Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 900,
      "nomeFisico" : "Id_Ufficio_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "testo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 773,
      "nomeFisico" : "testo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "NomeReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 901,
      "nomeFisico" : "NomeReferente_Pratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "Ufficio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 902,
      "nomeFisico" : "Ufficio_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Data inserimento",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 775,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 776,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "idNota",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 777,
      "nomeFisico" : "idNota_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "idPosizione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 778,
      "nomeFisico" : "idPosizione_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "idVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 781,
      "nomeFisico" : "idVisualizzatore_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 782,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 783,
      "nomeFisico" : "key_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 784,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "ruolo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 786,
      "nomeFisico" : "ruolo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 37,
      "nome" : "IdReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 985,
      "nomeFisico" : "IdReferente_Pratica_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 783
  }
}, {
  "nome" : "Entita Derivata - Preavviso Eventi Calendario (NEW)",
  "regola" : "RGLA_PRVVSO_EVNTI_CLNDRO_NEW",
  "campoChiave" : "evento_id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 15451,
    "descrizione" : "Entita Derivata - Preavviso Eventi Calendario (NEW)",
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'evento_id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n\t    [\r\n            [\r\n               nome: 'evento_id',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],[\r\n               nome: 'istanzaTask_id',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],[\r\n               nome: 'istanzaProcesso_id',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],[\r\n               nome: 'posizione_id',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],[\r\n               nome: 'gestore_id',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n            \tnome: 'istituto',\t\r\n            \tdescrizione: 'Istituto',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n            \tnome: 'abi',\t\r\n            \tdescrizione: 'ABI',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n            \tnome: 'ndg',\r\n    \t        descrizione: 'NDG',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n            \tnome: 'intestazione',\r\n    \t        descrizione: 'Intestazione',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n            \tnome: 'gestore',\r\n    \t        descrizione: 'Referente pratica',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n               nome: 'tipoEventoCalendario',\r\n               descrizione: 'Tipo evento',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],[\r\n               nome: 'oggetto',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],[\r\n               nome: 'dataInizio',\r\n               descrizione: 'Data scadenza',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n            ],[\r\n               nome: 'dataFine',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n            ],[\r\n               nome: 'giorniTolleranza',\r\n               descrizione: 'Tolleranza',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],[\r\n               nome: 'giorniPreavviso',\r\n               descrizione: 'Preavviso',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],[\r\n               nome: 'codiceTask',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],[\r\n               nome: 'nomeTask',\r\n               descrizione: 'Task',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],[\r\n               nome: 'nomeProcesso',\r\n               descrizione: 'Processo',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],[\r\n               nome: 'giorniAllaScadenza',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ]\r\n        ]\r\n\t    \r\n\t}\r\n\t    \r\n\t//Se giorniAllaScadenza < 0 ==> Scadenza passata\r\n\tpublic Collection<?> getData() {\r\n\t    \r\n        def eventi = entityManager.createQuery(\"\"\"    \r\n            select                    \r\n                new Map(\r\n        \t\t\tec.id as evento_id,\r\n        \t\t\tit.id as istanzaTask_id,\r\n        \t\t\tip.id as istanzaProcesso_id,\r\n        \t\t\t\r\n        \t\t\tp.id as posizione_id,\r\n                    eom.id as istituto_id,\r\n                    eom.nomeCompleto as istituto,\r\n                    eom.codiceIdentificativo as abi,\r\n                    p.ndgControparte as ndg,\r\n                    p.intestazione as intestazione,\r\n                    eo.id as gestore_id,\r\n                    eo.nomeCompleto as gestore,\r\n        \t\t\t\r\n        \t\t\ttec.descrizione as tipoEventoCalendario,\r\n        \t\t\t\r\n        \t\t\tec.oggetto as oggetto,\r\n        \t\t\tec.dataInizio as dataInizio,\r\n        \t\t\tec.dataFine as dataFine,\r\n        \t\t\tcoalesce(ec.giorniTolleranza,0) as giorniTolleranza,\r\n        \t\t\tcoalesce(ec.giorniPreavviso,0) as giorniPreavviso,\r\n        \t\t\t\r\n        \t\t\tdp.nome as nomeProcesso,\r\n        \t\t\tdt.nome as nomeTask,\r\n        \t\t\tdt.codiceNodo as codiceTask,\r\n        \t\t\t\r\n        \t\t\tday_diff(current_date(), ec.dataInizio) as giorniAllaScadenza\r\n                )\r\n                from EventoCalendario ec, Posizione p\r\n\r\n                left join ec.tipoEventoCalendario tec\r\n                join ec.istanzaTask it\r\n                join it.definizioneTask dt\r\n                join it.istanzaProcesso ip\r\n                join ip.definizioneProcesso dp\r\n        \t    join ip.entiteProcessi ep with ep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n        \t    \r\n                left join p.elementoOrganizzativoMandante eom\r\n                join p.infoEntita ie with ie.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n                left join ie.storiciReferentiEntite sre with sre.corrente = true\r\n                left join sre.ruoloReferenteEntita rre with rre.descrizione in ('Referente')\r\n                left join sre.elementoOrganizzativoReferente eo \r\n        \t    \r\n                where \r\n                    p.id = ep.idEntita \r\n                    and coalesce(ec.giorniPreavviso,0) > 0 \r\n                    and day_diff(current_date(), ec.dataInizio) > 0\r\n                    and coalesce(ec.giorniPreavviso,0) > day_diff(current_date(), ec.dataInizio)\r\n        \"\"\").resultList\r\n\r\n        eventi\r\n    }\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 15451,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "RGLA_PRVVSO_EVNTI_CLNDRO_NEW",
      "descrizione" : "Regola Preavviso Eventi Calendario (NEW)",
      "templateTestoRegola" : null,
      "oggetto_id" : 15451,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 38,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Entita Derivata - Preavviso Eventi Calendario (NEW)",
    "dataUltimoAggiornamentoDati" : 1552805947340,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : "Tipo evento",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "tipoEventoCalendario",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 937,
      "nomeFisico" : "tipoEventoCalendario_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "posizione_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 938,
      "nomeFisico" : "posizione_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "DataFine",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 939,
      "nomeFisico" : "DataFine_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "codiceTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 940,
      "nomeFisico" : "codiceTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Data scadenza",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "dataInizio",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 941,
      "nomeFisico" : "dataInizio_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "evento_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 942,
      "nomeFisico" : "evento_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "giorniAllaScadenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 943,
      "nomeFisico" : "giorniAllaScadenza_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Preavviso",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "giorniPreavviso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 944,
      "nomeFisico" : "giorniPreavviso_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Tolleranza",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "giorniTolleranza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 946,
      "nomeFisico" : "giorniTolleranza_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "istanzaProcesso_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 947,
      "nomeFisico" : "istanzaProcesso_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "istanzaTask_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 948,
      "nomeFisico" : "istanzaTask_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Task",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "nomeTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 949,
      "nomeFisico" : "nomeTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "oggetto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 950,
      "nomeFisico" : "oggetto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "dataFine",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 951,
      "nomeFisico" : "dataFine_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Processo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "nomeProcesso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 952,
      "nomeFisico" : "nomeProcesso_s"
    }, {
      "multivalore" : null,
      "descrizione" : "NDG",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 953,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Istituto",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "istituto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 954,
      "nomeFisico" : "istituto_s"
    }, {
      "multivalore" : null,
      "descrizione" : "ABI",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "abi",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 955,
      "nomeFisico" : "abi_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Referente pratica",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "gestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 956,
      "nomeFisico" : "gestore_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Intestazione",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 957,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 38,
      "nome" : "gestore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 958,
      "nomeFisico" : "gestore_id_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 942
  }
}, {
  "nome" : "Entità Derivata Notifiche/Allarmi (Ottimizzata)",
  "regola" : "NTFCA_ALLRMI_CHSRA_TASK_OTTMZZTA",
  "campoChiave" : "key",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 15465,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Sistema",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'key' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() { \r\n\t    [\r\n            [\r\n    \t        nome: 'posizioneId',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t       \r\n    \t    ], [\r\n    \t        nome: 'Soggetto',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'Processo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'idTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'idProcesso',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'codiceTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],  [\r\n    \t        nome: 'Task',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'statoIstanzaTask',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'statoIstanzaProcesso',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'codiceAttributo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'Attributo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'data',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'giorno',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'diffGiorniAllaScadenza',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'diffGiorniAdOggi',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'idVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'ruoloVisualizzatore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ],\r\n    \t    [\r\n    \t        nome: 'key',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ]\r\n\t    ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        \r\n\tdef indice = 0        \r\n\tdef query = entityManager.createQuery(\"\"\"\r\n\t\tselect \r\n\t\t\tnew Map(\r\n\t\t\t\tp.id as posizioneId,\r\n\t\t\t\tp.intestazione as Soggetto,\r\n\t\t\t\tp.ndgControparte as ndg,\r\n\t\t\t\teo_p.id as idVisualizzatore,\r\n\t\t\t\trre_p.descrizione as ruoloVisualizzatore,\r\n\t\t\t\tdp.nome as Processo,\r\n\t\t\t\tist.id as idTask,\r\n\t\t\t\tip.id as idProcesso,\r\n\t\t\t\tdt.codiceIdentificativo as codiceTask,\r\n\t\t\t\tist.definizioneTask.nome as Task,\r\n\t\t\t\tist.statoIstanza as statoIstanzaTask,\r\n\t\t\t\tip.statoIstanza as statoIstanzaProcesso,\r\n\t\t\t\tiat.attributoProcesso.codice as codiceAttributo,\r\n\t\t\t\tiat.attributoProcesso.descrizione as Attributo,\r\n\t\t\t\tiat.valoreData as data,\r\n\t\t\t\tday(iat.valoreData) as giorno,\r\n\t\t\t\tday_diff(current_date(),iat.valoreData) as diffGiorniAllaScadenza,\r\n\t\t\t\tday_diff(iat.valoreData,current_date()) as diffGiorniAdOggi\r\n\t\t\t)\r\n\t\tfrom EntitaProcesso ep, Posizione p\r\n\t\t\tjoin ep.istanzaProcesso ip\r\n\t\t\tjoin ip.definizioneProcesso dp\r\n\t\t\tjoin ip.istanzeTasks ist\r\n\t\t\tjoin ist.definizioneTask dt \r\n\t\t\tleft join ist.istanzeAttributiTasks iat\r\n\t\t\t\r\n\t\t\tjoin p.infoEntita ie_p\r\n\t\t\tjoin ie_p.storiciReferentiEntite sre_p\r\n\t\t\tjoin sre_p.elementoOrganizzativoReferente eo_p \r\n\t\t\tjoin sre_p.ruoloReferenteEntita rre_p\r\n\t\twhere\r\n\t\t\tep.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n\t\t\tand dt.codiceIdentificativo in ('DPSTO_CTU_r7', 'AGGDCZNE', 'DPSTO_CTU_r9', 'AGGDCZNE_r1')\r\n\t\t\tand sre_p.corrente = 1\r\n\t\t\tand rre_p.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n\t\t\tand ep.idEntita = p.id\r\n\t\"\"\").resultList\r\n\t\t.collect{\r\n\t\t    it.key = \"\"+it.idTask + \" - \"+ it.posizioneId + \" - \" + it.idVisualizzatore\r\n\t\t\tit.id = indice++\r\n\t\t\tit\r\n\t\t}\r\n    }\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 15465,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "NTFCA_ALLRMI_CHSRA_TASK_OTTMZZTA",
      "descrizione" : "Notifica/Allarmi Alla Chiusura Del Task (Ottimizzata)",
      "templateTestoRegola" : null,
      "oggetto_id" : 15465,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 42,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Entità Derivata Notifiche/Allarmi (Ottimizzata)",
    "dataUltimoAggiornamentoDati" : 1553677408595,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "codiceAttributo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2016,
      "nomeFisico" : "codiceAttributo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "codiceTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2017,
      "nomeFisico" : "codiceTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2018,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "diffGiorniAdOggi",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2019,
      "nomeFisico" : "diffGiorniAdOggi_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "diffGiorniAllaScadenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2020,
      "nomeFisico" : "diffGiorniAllaScadenza_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "giorno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2021,
      "nomeFisico" : "giorno_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "idTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2022,
      "nomeFisico" : "idTask_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "idProcesso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2023,
      "nomeFisico" : "idProcesso_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "statoIstanzaProcesso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2024,
      "nomeFisico" : "statoIstanzaProcesso_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "statoIstanzaTask",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2025,
      "nomeFisico" : "statoIstanzaTask_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "posizioneId",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2026,
      "nomeFisico" : "posizioneId_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "idVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2027,
      "nomeFisico" : "idVisualizzatore_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "key",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2028,
      "nomeFisico" : "key_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2029,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "ruoloVisualizzatore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2030,
      "nomeFisico" : "ruoloVisualizzatore_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "Task",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2012,
      "nomeFisico" : "Task_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "Attributo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2013,
      "nomeFisico" : "Attributo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "Processo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2014,
      "nomeFisico" : "Processo_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 42,
      "nome" : "Soggetto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2015,
      "nomeFisico" : "Soggetto_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 2028
  }
}, {
  "nome" : "Posizioni (Cedacri) (Ottimizzata)",
  "regola" : "PSZNI_CDCRI_OTTMZZTO",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 15466,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Sistema",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\nimport it.sydema.laweb.services.ListaTemporaneaService\r\nimport it.sydema.laweb.repository.extended.PosizioneSygesRepository\r\nimport it.sydema.laweb.services.ContabilitaSygesService\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\t\t\r\n\tpublic Collection<?> getCampi() {\r\n        [\r\n            [\r\n    \t        nome: 'id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO,\r\n    \t        entita: Entita.POSIZIONE\r\n    \t    ], [\r\n    \t        nome: 'intestazione',\r\n    \t        descrizione: 'Nominativo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'ndg',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        ricercaFullText: true\r\n    \t    ], [\r\n    \t        nome: 'codicePratica',\r\n    \t        descrizione: 'Posizione Syges3',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], [\r\n    \t        nome: 'codiceIstituto',\r\n    \t        descrizione: 'Codice istituto',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'classificazione',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataApertura',\r\n    \t        descrizione: 'Data inizio',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'dataSofferenza',\r\n    \t        descrizione: 'Data inizio sofferenza',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'dataChiusura',\r\n    \t        descrizione: 'Data chiusura',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'stato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'filiale_id',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'filiale_nomeCompleto',\r\n    \t        descrizione: 'Filiale',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'garanziePersonali',\r\n    \t        descrizione: 'Garanzie personali',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.BOOLEANO,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'garanzieReali',\r\n    \t        descrizione: 'Garanzie reali',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.BOOLEANO,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'idGestore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeGestore',\r\n    \t        descrizione: 'Gestore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataAssegnazioneGestore',\r\n    \t        descrizione: 'Data assegnazione gestore',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'idMandatario',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeMandatario',\r\n    \t        descrizione: 'Mandatario',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataAssegnazioneMandatario',\r\n    \t        descrizione: 'Data assegnazione Mandatario',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'idUfficioRecuperoEsternalizzato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], [\r\n    \t        nome: 'nomeUfficioRecuperoEsternalizzato',\r\n    \t        descrizione: 'Uff. Rec. Esternalizzato',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'nomeLegaleEsterno',\r\n    \t        descrizione: 'Legale Esterno',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'nomeUfficioContenzioso',\r\n    \t        descrizione: 'Uff. Contenzioso',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'nomeUfficioCreditiaRecupero',\r\n    \t        descrizione: 'Uff. crediti a rec',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA,\r\n    \t        generaFacet: true\r\n    \t    ], [\r\n    \t        nome: 'dataAssegnazioneUfficioRecuperoEsternalizzato',\r\n    \t        descrizione: 'Data assegnazione Uff. Rec. Est.',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n    \t    ], [\r\n    \t        nome: 'saldo',\r\n    \t        descrizione: 'Credito lordo',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DECIMALE\r\n    \t    ], [\r\n    \t        nome: 'incassi',\r\n    \t        descrizione: 'Incassi',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DECIMALE\r\n    \t    ], \r\n    \t    \r\n    \t    [\r\n    \t        nome: 'prevPerditaTotale',\r\n    \t        descrizione: 'prevPerditaTotale',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DECIMALE\r\n    \t    ] \r\n\t    ]\r\n\t}\r\n\t\t\t\r\n\tpublic Collection<?> getData() {\r\n\t    \r\n\t    \r\n    def data = entityManager.createQuery(\"\"\"\r\n        select new Map(\r\n            p.id as id,\r\n            p.intestazione as intestazione,\r\n            p.ndgControparte as ndg,\r\n            p.codicePratica as codicePratica,\r\n            case when p.tipologiaPosizione = it.sydema.laweb.domain.Enums\\$TipologiaPosizione.SOFFERENZA \r\n                then 'Sofferenza' else 'Incaglio' end as classificazione,\r\n            p.dataApertura as dataApertura,\r\n            p.dataSofferenza as dataSofferenza,\r\n            p.dataChiusura as dataChiusura,\r\n            p.codiceIstituto as codiceIstituto,\r\n            case when p.dataChiusura is not null then 'Chiusa' else 'Aperta' end as stato,\r\n            f.id as filiale_id,\r\n            f.nomeCompleto as filiale_nomeCompleto,\r\n            case when exists (select g from p.garanzie g \r\n                    where g.tipoGaranzia.classeGaranzia = it.sydema.laweb.domain.Enums\\$ClasseGaranzia.PERSONALE)\r\n                then true else false end as garanziePersonali,\r\n            case when exists (select g from p.garanzie g \r\n                    where g.tipoGaranzia.classeGaranzia in (\r\n                        it.sydema.laweb.domain.Enums\\$ClasseGaranzia.IPOTECARIA,\r\n                        it.sydema.laweb.domain.Enums\\$ClasseGaranzia.PIGNORATIZIA))\r\n                then true else false end as garanzieReali\r\n        )\r\n        from\r\n            Posizione p\r\n            left join p.elementoOrganizzativoFilialePrevalente f\r\n            \"\"\")\r\n        .resultList\r\n        \r\n\r\n\tdef referenti = data\r\n\t.findAll{it.id != null}\r\n\t.collect{[id : it.id]}\r\n\t.collate(1000)\r\n\t.collectMany{\r\n\t\tentityManager.createQuery(\"\"\"\r\n\t\t\tselect new Map(\r\n\t\t\t\tie.idEntita as posizione_id,\r\n\t\t\t\tsre.dataInizioValidita as dataInizioValidita,\r\n\t\t\t\teor.id as elementoOrganizzativoReferente_id,\r\n\t\t\t\teor.nomeCompleto as elementoOrganizzativoReferente_nomeCompleto,\r\n\t\t\t\trre.descrizione as ruolo\r\n\t\t\t)\r\n\t\t\tfrom\r\n\t\t\t\tStoricoReferenteEntita sre, Posizione p\r\n\t\t\t\tjoin sre.infoEntita ie\r\n\t\t\t\tjoin sre.elementoOrganizzativoReferente eor\r\n\t\t\t\tjoin sre.ruoloReferenteEntita rre\r\n\t\t\twhere\r\n\t\t\t\tie.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n\t\t\t\tand ie.idEntita = p.id\r\n\t\t\t\tand sre.corrente = true\r\n\t\t\t\tand rre.descrizione in ('Gestore', 'Mandatario', 'Ufficio Recupero Esternalizzato','Legale esterno','Ufficio Crediti a Recupero','Ufficio Contenzioso')\r\n\t\t\t\tand p.id in (:id)\r\n\t\t\t\t\"\"\")\r\n\t\t\t.setParameter(\"id\",it.id)\r\n\t\t\t.resultList\r\n\t}\t\r\n\t.groupBy {\r\n\t\tit.posizione_id\r\n\t}\r\n\t\t\r\n\t\r\n\tdef incassi = entityManager.createNativeQuery (\"\"\"\r\n    \tselect \r\n            incassi.id as id,\r\n            incassi.incassi as incassi,\r\n            prevPerditaTotale.prevPerditaTotale as prevPerditaTotale\r\n            from (\r\n             select  \r\n    \t\t id,\r\n             sum(incassi * segno) as incassi\r\n            from (\r\n               select\r\n                 R.posizione_id as id,\r\n                 case when C.FSTORNO = 'S' then -1 else 1 end as segno,\r\n                 case\r\n                   when CAT.FCATCONT = 'C' and C.TCAUSALE in ('INCE', 'INCA') then M.IMOVIMEN\r\n                   else 0\r\n                 end as incassi\r\n               from LAWEB4.Rapporto R\r\n               left join SYGES.CATEGORIESYGES CAT on\r\n                 CAT.CISTNUME = R.CISTNUME and\r\n                 CAT.FINCSOFF = R.FINCSOFF and\r\n                 CAT.CCATEGOR = R.CCATEGOR and\r\n                 CAT.CSOTCATE = R.CSOTCATE\r\n               left join SYGES.MOVIMENTICONTABILISYGES M on\r\n                 M.CISTNUME = R.CISTNUME and\r\n                 M.FINCSOFF = R.FINCSOFF and\r\n                 M.CPRATICA = R.CPRATICA and\r\n                 M.CFILIALE = R.CFILIALE and\r\n                 M.CCATEGOR = R.CCATEGOR and\r\n                 M.CSOTCATE = R.CSOTCATE and\r\n                 M.CRAPPORT = R.CRAPPORT\r\n               left join SYGES.CAUSALICONTABILISYGES C on\r\n                 C.CISTNUME = M.CISTNUME and\r\n                 C.FCAUSALE = M.FCAUSALE and\r\n                 C.CCAUSALE = M.CCAUSALE\r\n            ) A\r\n            group by id ) Incassi \r\n    \t\tleft join (\r\n    \t\tselect\r\n              id,\r\n              sum(capitaleCassa + capitaleFirma + interessi) as prevPerditaTotale\r\n            from (\r\n               select\r\n                 R.posizione_id as id,\r\n                 case\r\n                    when RAP.FINCSOFF = 'S' and CAT.FCATCONT = 'C' then RAP.IDUBCAPI\r\n                    when RAP.FINCSOFF = 'I' and RAP.FCASFIRM = 'C' then RAP.IDUBCAPI\r\n                    else 0\r\n                 end as capitaleCassa,\r\n                 case\r\n                    when RAP.FINCSOFF = 'S' and CAT.FCATCONT = 'F' then RAP.IDUBCAPI\r\n                    when RAP.FINCSOFF = 'I' and RAP.FCASFIRM = 'F' then RAP.IDUBCAPI\r\n                    else 0\r\n                 end as capitaleFirma,\r\n                 RAP.IDUBINTE as interessi\r\n                 /* rapporti laweb */\r\n                 from LAWEB4.Rapporto R\r\n                 /* categorie */\r\n                 left join SYGES.CATEGORIESYGES CAT on\r\n                   CAT.CISTNUME = R.CISTNUME and\r\n                   CAT.FINCSOFF = R.FINCSOFF and\r\n                   CAT.CCATEGOR = R.CCATEGOR and\r\n                   CAT.CSOTCATE = R.CSOTCATE\r\n                 /* rapporti syges  */\r\n                 left join SYGES.RAPPORTOSYGES RAP on\r\n                   RAP.CISTNUME = R.CISTNUME and\r\n                   RAP.FINCSOFF = R.FINCSOFF and\r\n                   RAP.CPRATICA = R.CPRATICA and\r\n                   RAP.CFILIALE = R.CFILIALE and\r\n                   RAP.CCATEGOR = R.CCATEGOR and\r\n                   RAP.CSOTCATE = R.CSOTCATE and\r\n                   RAP.CRAPPORT = R.CRAPPORT\r\n            ) A\r\n            group by id\r\n    \t\t) prevPerditaTotale on incassi.id = prevPerditaTotale.id\r\n\t\t\"\"\")\r\n\t.resultList\r\n    .collectEntries{[(it[0]):[incassi:it[1],prevPerditaTotale:it[2]]]}\r\n\t\t\r\n\t\t\r\n    def saldi = entityManager.createNativeQuery(\"\"\" \r\n            select \r\n        \t  A.posizione_id  as id,\r\n        \t  sum(A.capitale + A.interessi + A.interessiDiMora + A.spese) as saldo\r\n            from (\r\n        \t\t   select\r\n        \t\t\t R.id as rapporto_id,\r\n        \t\t\t r.posizione_id as posizione_id,\r\n        \t\t\t CAT.FCATCONT,\r\n        \t\t\t RAP.ISALCAPI + RAP.ISALIADD as capitale,\r\n        \t\t\t RAP.ISALISCO + RAP.ISALICCO as interessi,\r\n        \t\t\t RAP.ISALISMO + RAP.ISALICMO as interessiDiMora,\r\n        \t\t\t RAP.ISALSPES as spese\r\n        \t\t\t /* rapporti laweb */\r\n        \t\t\t from LAWEB4.Rapporto R\r\n        \t\t\t /* categorie */\r\n        \t\t\t left join SYGES.CATEGORIESYGES CAT on\r\n        \t\t\t   CAT.CISTNUME = R.CISTNUME and\r\n        \t\t\t   CAT.FINCSOFF = R.FINCSOFF and\r\n        \t\t\t   CAT.CCATEGOR = R.CCATEGOR and\r\n        \t\t\t   CAT.CSOTCATE = R.CSOTCATE\r\n        \t\t\t /* rapporti syges  */\r\n        \t\t\t left join SYGES.RAPPORTOSYGES RAP on\r\n        \t\t\t   RAP.CISTNUME = R.CISTNUME and\r\n        \t\t\t   RAP.FINCSOFF = R.FINCSOFF and\r\n        \t\t\t   RAP.CPRATICA = R.CPRATICA and\r\n        \t\t\t   RAP.CFILIALE = R.CFILIALE and\r\n        \t\t\t   RAP.CCATEGOR = R.CCATEGOR and\r\n        \t\t\t   RAP.CSOTCATE = R.CSOTCATE and\r\n        \t\t\t   RAP.CRAPPORT = R.CRAPPORT\r\n        \t\t) A\r\n            group by  A.posizione_id\r\n        \"\"\")\r\n    .resultList\r\n    .collectEntries{[(it[0]):[saldi:it[1]]]}   \r\n\t\r\n\t\r\n\tdata.collect { p ->\r\n            referenti[p.id]?.each {\r\n                def r = it.ruolo.replaceAll(\"\\\\s\",\"\")\r\n                if(r.equals(\"Gestore\")){\r\n\t\t\t\t\tif(it.dataInizioValidita > p[\"dataAssegnazione$r\"]){\r\n\t\t\t\t\t\tp[\"dataAssegnazione$r\"] = it.dataInizioValidita\r\n\t\t\t\t\t\tp[\"id$r\"] = it.elementoOrganizzativoReferente_id\r\n\t\t\t\t\t\tp[\"nome$r\"] = it.elementoOrganizzativoReferente_nomeCompleto\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tp[\"dataAssegnazione$r\"] = it.dataInizioValidita\r\n\t\t\t\t\tp[\"id$r\"] = it.elementoOrganizzativoReferente_id\r\n\t\t\t\t\tp[\"nome$r\"] = it.elementoOrganizzativoReferente_nomeCompleto\r\n\t\t\t\t}\r\n            }\r\n            p['saldo'] = saldi[p.id]?.saldi\r\n\t\t\tp['incassi'] = incassi[p.id]?.incassi\r\n\t\t\tp['prevPerditaTotale'] = incassi[p.id]?.prevPerditaTotale\r\n\t\t\tp\r\n    }\r\n\t\t\r\n\t\t\r\n\t}\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 15466,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PSZNI_CDCRI_OTTMZZTO",
      "descrizione" : "Posizioni (Cedacri) (Ottimizzato)",
      "templateTestoRegola" : null,
      "oggetto_id" : 15466,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 44,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Posizioni (Cedacri) (Ottimizzata)",
    "dataUltimoAggiornamentoDati" : 1553677470470,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : "Mandatario",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "nomeMandatario",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2048,
      "nomeFisico" : "nomeMandatario_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "idGestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2049,
      "nomeFisico" : "idGestore_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Data assegnazione Uff. Rec. Est.",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "dataAssegnazioneUfficioRecuperoEsternalizzato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2050,
      "nomeFisico" : "dataAssegnazioneUfficioRecuperoEsternalizzato_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Data chiusura",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "dataChiusura",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2051,
      "nomeFisico" : "dataChiusura_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : "POSIZIONE",
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2052,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "idUfficioRecuperoEsternalizzato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2053,
      "nomeFisico" : "idUfficioRecuperoEsternalizzato_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Data inizio sofferenza",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "dataSofferenza",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2054,
      "nomeFisico" : "dataSofferenza_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "prevPerditaTotale",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DECIMALE",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "prevPerditaTotale",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2055,
      "nomeFisico" : "prevPerditaTotale_d"
    }, {
      "multivalore" : null,
      "descrizione" : "Garanzie personali",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "BOOLEANO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "garanziePersonali",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2056,
      "nomeFisico" : "garanziePersonali_b"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "filiale_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2057,
      "nomeFisico" : "filiale_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "idMandatario",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2058,
      "nomeFisico" : "idMandatario_i"
    }, {
      "multivalore" : null,
      "descrizione" : "Filiale",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "filiale_nomeCompleto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2059,
      "nomeFisico" : "filiale_nomeCompleto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "classificazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2031,
      "nomeFisico" : "classificazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Codice istituto",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "codiceIstituto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2032,
      "nomeFisico" : "codiceIstituto_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Credito lordo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DECIMALE",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "saldo",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2033,
      "nomeFisico" : "saldo_d"
    }, {
      "multivalore" : null,
      "descrizione" : "Uff. crediti a rec",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "nomeUfficioCreditiaRecupero",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2034,
      "nomeFisico" : "nomeUfficioCreditiaRecupero_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Nominativo",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 44,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2035,
      "nomeFisico" : "intestazione_t"
    }, {
      "multivalore" : null,
      "descrizione" : "Legale Esterno",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "nomeLegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2036,
      "nomeFisico" : "nomeLegaleEsterno_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Posizione Syges3",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "codicePratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2037,
      "nomeFisico" : "codicePratica_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Uff. Rec. Esternalizzato",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "nomeUfficioRecuperoEsternalizzato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2038,
      "nomeFisico" : "nomeUfficioRecuperoEsternalizzato_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "stato",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2039,
      "nomeFisico" : "stato_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Gestore",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "nomeGestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2040,
      "nomeFisico" : "nomeGestore_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Data inizio",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "dataApertura",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2041,
      "nomeFisico" : "dataApertura_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Data assegnazione gestore",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "dataAssegnazioneGestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2042,
      "nomeFisico" : "dataAssegnazioneGestore_dt"
    }, {
      "multivalore" : null,
      "descrizione" : "Data assegnazione Mandatario",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "dataAssegnazioneMandatario",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2043,
      "nomeFisico" : "dataAssegnazioneMandatario_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : true,
      "entitaDerivata_id" : 44,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2044,
      "nomeFisico" : "ndg_t"
    }, {
      "multivalore" : null,
      "descrizione" : "Uff. Contenzioso",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "nomeUfficioContenzioso",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2045,
      "nomeFisico" : "nomeUfficioContenzioso_s"
    }, {
      "multivalore" : null,
      "descrizione" : "Incassi",
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DECIMALE",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "incassi",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2046,
      "nomeFisico" : "incassi_d"
    }, {
      "multivalore" : null,
      "descrizione" : "Garanzie reali",
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "BOOLEANO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 44,
      "nome" : "garanzieReali",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2047,
      "nomeFisico" : "garanzieReali_b"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 2052
  }
}, {
  "nome" : "Posizione (Ottimizata)",
  "regola" : "PSZNI_OTTMZZTA_r1",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 15467,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Sistema",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\ndef index = 0\r\n\r\ndef referenti = entityManager.createQuery(\"\"\"select\r\n    new Map(\r\n    \r\n        iat.valoreIntero as id,\r\n        ieA.idEntita as procedura_id,\r\n        eapA.idElemento as posizione_id,\r\n        rreA.descrizione as ruolo,\r\n        eoA.id as idA,\r\n        eoA.nomeCompleto as nome,\r\n        sreA.dataInizioValidita as data,\r\n        day_diff(sreA.dataInizioValidita, current_date()) as giorni\r\n        \r\n     )\r\n    from EntitaProcesso ep, EntitaProcesso ep2, InfoEntita ieA, ProceduraLegale plA\r\n        \r\n        join ieA.storiciReferentiEntite sreA\r\n        join sreA.ruoloReferenteEntita rreA\r\n        join sreA.elementoOrganizzativoReferente eoA\r\n        join plA.elementiAssociatiProcedureLegali eapA with eapA.tipoElementoAssociatoProceduraLegale = it.sydema.laweb.domain.Enums\\$TipoElementoAssociatoProceduraLegale.POSIZIONE\r\n        \r\n        join ep.istanzaProcesso ip\r\n        join ip.istanzeTasks it\r\n        join it.definizioneTask dt\r\n        join it.istanzeAttributiTasks iat\r\n        join iat.attributoProcesso ap\r\n        join ep2.istanzaProcesso ip2\r\n    where\r\n        ieA.idEntita = plA.id\r\n        and ip.id = ip2.id\r\n        and sreA.corrente = true\r\n        and ieA.idEntita = ep.idEntita\r\n        \r\n        and ap.codice in ('LGLE_INCRCTO','LGLE_INCRCTO_r1','LGLE_INCRCTO_r2')\r\n        and ep.entita = it.sydema.laweb.domain.Enums\\$Entita.PROCEDURA_LEGALE\r\n        and ep2.entita = it.sydema.laweb.domain.Enums\\$Entita.POSIZIONE\r\n        \r\n        and ieA.entita = it.sydema.laweb.domain.Enums\\$Entita.PROCEDURA_LEGALE\r\n        and rreA.descrizione in ('Referente', 'Responsabile Ufficio Referente', 'SLE', 'SRE')\r\n        \"\"\")\r\n  .resultList\r\n  \r\n  def referentiPosizione_id = referenti.posizione_id.join(\",\")\r\n  \r\n  def posizioni = entityManager.createQuery(\"\"\"select\r\n    new Map(\r\n        p.id as id,\r\n        p.intestazione as intestazione,\r\n        p.ndgControparte as ndg,\r\n        eo.id as mandante_id,\r\n        eo.nomeCompleto as mandante,\r\n\t\t'Studio legale esterno' as classeSLE\r\n    )\r\n    from\r\n        Posizione p\r\n        left join p.elementoOrganizzativoMandante eo\r\n        where p.dataChiusura is null\r\n        and p.id in ($referentiPosizione_id)\r\n        \"\"\")\r\n    .resultList\r\n  \r\n\r\n  def referentiId = referenti.id.join(\",\")\r\n  \r\ndef referentiBU = entityManager.createQuery(\"\"\"\r\n    select distinct new Map(\r\n    \teo.id as id,\r\n    \teo.nomeCompleto as nome,\r\n    \tsbu.elementoOrganizzativo.id as sbuId,\r\n    \teor.id as gestoreId\r\n    \t\r\n    \t\r\n    )\r\n    from ElementoOrganizzativo eo, RuoloReferenteEntita rre\r\n    join eo.storiciPersone sp\r\n    join sp.storicoBusinessUnit sbu\r\n    join sbu.storicoStrutturaOrganizzativa sso\r\n    \r\n    join rre.storiciReferentiEntite sre\r\n    join sre.elementoOrganizzativoReferente eor\r\n    join eo.storiciPersone spr\r\n    join sp.storicoBusinessUnit sbur\r\n    \r\n    \r\n    where sre.corrente = true\r\n        and sso.corrente = true\r\n        and sbu.id = sbur.id\r\n        and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n        and sso.corrente = true\r\n        and eor.id in ($referentiId)\r\n        \r\n    \"\"\").resultList\r\n    def referenti2  = []\r\n    def refBU\r\n    def pos\r\n    \r\n    \r\n    \r\n    referenti.collect{ ref ->\r\n                def temp = [:]\r\n//---------------------------------------------------------------------------------------------\r\n                pos = posizioni.find{ref.posizione_id == it.id}\r\n                if(pos){\r\n                    \r\n                    def prefix = ref.ruolo == 'Società Recupero Esterna' ? 'sre' :\r\n(ref.ruolo == 'Legale Esterno' || ref.ruolo == 'SLE' || ref.ruolo == 'Studio Legale Esterno Procedura' || ref.ruolo == 'Studio Legale Esterno') ? 'sle' : 'gestore'\r\n\r\n                        temp[prefix + '_id'] = pos.id\r\n                        temp[prefix] = pos.intestazione\r\n                        temp[prefix + '_giorni'] = ref.giorni\r\n                        temp['ndg'] = pos.ndg\r\n                        temp['intestazione'] = pos.intestazione\r\n                }\r\n//----------------------------------------------------------------------------------------------\r\n                temp += [\r\n                    id: ref.idP,\r\n                    istituto: null,\r\n                    data: ref.data\r\n                ]\r\n//----------------------------------------------------------------------------------------------\r\n                refBU = referentiBU.find{it.gestoreId == ref.id}\r\n                if(refBU){\r\n                    temp += [\r\n                        nome: refBU.nome ,\r\n                        id:  refBU.id,\r\n                    ]\r\n                } else{\r\n                    temp += [\r\n                        nome: ref.nome ,\r\n                        id:  ref.id,\r\n                    ]\r\n                }\r\n//----------------------------------------------------------------------------------------------\r\n            temp\r\n            }\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n\t    [       \r\n\t        [   \r\n            \tnome: 'id',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'istituto',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'ndg',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'intestazione',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'gestore',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'gestore_giorni',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'gestore_id',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'sle',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'sle_giorni',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'sle_id',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'sre',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'sre_giorni',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'sre_id',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'data',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.DATA\r\n            ]\r\n    \t ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        posizioni\r\n\t}\r\n}",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 15467,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PSZNI_OTTMZZTA_r1",
      "descrizione" : "Posizioni (Ottimizzata)",
      "templateTestoRegola" : null,
      "oggetto_id" : 15467,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 46,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Posizione (Ottimizata)",
    "dataUltimoAggiornamentoDati" : 1553680684785,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 1986,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 1987,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 1996,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "gestore",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2063,
      "nomeFisico" : "gestore_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "DATA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "data",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2064,
      "nomeFisico" : "data_dt"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "gestore_giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2065,
      "nomeFisico" : "gestore_giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "gestore_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2066,
      "nomeFisico" : "gestore_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "istituto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2067,
      "nomeFisico" : "istituto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "sle",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2068,
      "nomeFisico" : "sle_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "sle_giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2069,
      "nomeFisico" : "sle_giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "sle_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2070,
      "nomeFisico" : "sle_id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "sre",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2071,
      "nomeFisico" : "sre_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "sre_giorni",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2072,
      "nomeFisico" : "sre_giorni_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 46,
      "nome" : "sre_id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2073,
      "nomeFisico" : "sre_id_i"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 1996
  }
}, {
  "nome" : "Posizioni - Reforged",
  "regola" : "PSZNI_RFRGD",
  "campoChiave" : "id",
  "campoUtente" : null,
  "entitaDerivata" : {
    "regola_id" : 15468,
    "descrizione" : null,
    "regola" : {
      "opzioni" : null,
      "oggettoModello_id" : null,
      "codiceArgomentoGuidaUtente" : null,
      "schemaInterfaccia" : null,
      "gruppo" : "Allarmi",
      "dominioRegola" : "NON_ASSEGNATO",
      "origineElemento" : "UTENTE",
      "contenuto" : "import it.sydema.laweb.domain.Enums.Entita\r\nimport it.sydema.laweb.domain.Enums.TipoDatoCampoEntitaDerivata\r\n\r\n\r\ndef posizioni = entityManager.createQuery(\"\"\"\r\nselect distinct\r\n    new Map(\r\n        p.id as                     id,\r\n        p.intestazione as           intestazione,\r\n        p.ndgControparte as         ndg,\r\n        eo.id as                    id_istituto,\r\n        eo.nomeCompleto as          nome_istituto,\r\n\t\t'Studio legale esterno' as  classeSLE,\r\n\t\teor.nomeCompleto as         NomeReferente_Pratica,\r\n        eor.id as                   IdReferente_Pratica,\r\n        day_diff(sre.dataInizioValidita, current_date()) as giorni_gestore\r\n        )\r\n    from\r\n        Posizione p, StoricoReferenteEntita sre\r\n        left join   p.elementoOrganizzativoMandante eo\r\n        join        p.infoEntita                       ie\r\n        join        sre.ruoloReferenteEntita           rre\r\n        join        sre.elementoOrganizzativoReferente eor\r\n        where   p.dataChiusura is null\r\n                and sre.infoEntita.id = p.infoEntita.id\r\n                and sre.corrente = true\r\n                and rre.descrizione = 'Referente'\r\n        \"\"\").resultList\r\n        \r\n        \r\n        \r\ndef referenti_Pratica = \r\n        entityManager.createQuery(\"\"\"\r\n        select\r\n            new Map(\r\n                p.id as                     posizione_id,\r\n        \t\teor.nomeCompleto as         NomeReferente_Pratica,\r\n                eor.id as                   IdReferente_Pratica,\r\n                rre.descrizione as          ruolo,\r\n                sre.dataInizioValidita as   data,\r\n                day_diff(sre.dataInizioValidita, current_date()) as giorni_gestore\r\n                )\r\n            from\r\n                Posizione p, StoricoReferenteEntita sre\r\n                left join   p.elementoOrganizzativoMandante eo\r\n                join        p.infoEntita                       ie\r\n                join        sre.ruoloReferenteEntita           rre\r\n                join        sre.elementoOrganizzativoReferente eor\r\n                where   p.dataChiusura is null\r\n                        and sre.infoEntita.id = p.infoEntita.id\r\n                        and sre.corrente = true\r\n                        and rre.descrizione in ('Referente', 'Gestore', 'Mandatario', 'Ufficio Recupero Esternalizzato',\r\n                                                'Legale esterno','Ufficio Crediti a Recupero',\r\n                                                'Ufficio Contenzioso', 'SRE', 'Società recupero crediti')\r\n                       \r\n        \"\"\")\r\n            \r\n        .resultList\t\t\t\t\t\r\n           \r\n    .groupBy {\r\n\t\tit.posizione_id\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\ndef referenti_Proceduralegale = posizioni\r\n    .findAll{it.id != null}\r\n\t.collect{[id : it.id]}\r\n\t.collate(1000)\r\n\t.collectMany{\r\n\t    entityManager.createQuery(\"\"\"\r\n        select\r\n            new Map(\r\n                ie.idEntita as procedura_id,\r\n                eap.idElemento as posizione_id,\r\n                rre.descrizione as ruolo,\r\n                eo.id as id,\r\n                eo.nomeCompleto as nome,\r\n                sre.dataInizioValidita as data,\r\n                day_diff(sre.dataInizioValidita, current_date()) as giorni\r\n            )\r\n        from    InfoEntita ie, ProceduraLegale pl\r\n        join    ie.storiciReferentiEntite sre\r\n        join    sre.ruoloReferenteEntita rre\r\n        join    sre.elementoOrganizzativoReferente eo\r\n        join    pl.elementiAssociatiProcedureLegali eap \r\n                with eap.tipoElementoAssociatoProceduraLegale = it.sydema.laweb.domain.Enums\\$TipoElementoAssociatoProceduraLegale.POSIZIONE\r\n        where\r\n                ie.entita = it.sydema.laweb.domain.Enums\\$Entita.PROCEDURA_LEGALE\r\n                and ie.idEntita = pl.id\r\n                and sre.corrente = true\r\n                and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente', 'SLE', 'SRE', 'Legale Esterno', 'Società recupero crediti')\r\n                and eap.idElemento in (:id)\r\n        \"\"\")\r\n    .setParameter(\"id\",it.id)    \r\n    .resultList\t\t\t\t\t\r\n    }\r\n    .groupBy {\r\n\t\tit.posizione_id\r\n\t}\r\n\t\r\n\t\r\n\t\r\ndef referentiBU =  posizioni\r\n    .findAll{it.id != null}\r\n\t.collect{[IdReferente_Pratica : it.IdReferente_Pratica]}\r\n\t.collate(1000)\r\n\t.collectMany{\r\n    entityManager.createQuery(\"\"\"\r\n    select distinct \r\n        new Map(\r\n            \teo.id as                                    id_eo,\r\n            \teo.nomeCompleto as                          nome_eo,\r\n            \tsbu.elementoOrganizzativo.id as\t\t\t\tId_Ufficio,\r\n                sbu.nomeCompleto as \t\t\t\t\t\tUfficio\r\n                )\r\n        from    ElementoOrganizzativo eo, RuoloReferenteEntita rre\r\n        join    eo.storiciPersone sp\r\n        join    sp.storicoBusinessUnit sbu\r\n        join    sbu.storicoStrutturaOrganizzativa sso\r\n        join    rre.storiciReferentiEntite sre\r\n        join    sre.elementoOrganizzativoReferente eor\r\n        join    eo.storiciPersone spr\r\n        where \r\n                sre.corrente = true\r\n                and rre.descrizione in ('Referente', 'Responsabile Ufficio Referente')\r\n                and sso.corrente = true\r\n                and eo.id in (:id)\r\n    \"\"\")     \r\n    .setParameter(\"id\",it.IdReferente_Pratica)    \r\n    .resultList\t\r\n    }\r\n    .collectEntries{[(it.id_eo): it]}\t\t\r\n\t\r\n\t\r\n\r\n\t\r\n\t\r\nposizioni.collect{ p->\r\n\t\r\n\tp['Ufficio_Referente'] = referentiBU[p.IdReferente_Pratica]?.Ufficio\r\n\tp['Id_Ufficio_Referente'] = referentiBU[p.IdReferente_Pratica]?.Id_Ufficio\r\n\t\r\n\treferenti_Proceduralegale[p.id]?.each{ ref ->\r\n            def r = ref.ruolo.replaceAll(\"\\\\s\",\"\")                \r\n            if(r.equals(\"Referente\")){\r\n\t\t\t\tif(ref.data > p[\"data_$r\"]){\r\n\t\t\t\t    p[\"data_$r\"] = ref.data\r\n\t\t\t\t    p[\"giorni_$r\"] = ref.giorni\r\n\t\t\t\t\tp[\"id_$r\"] = ref.id\r\n\t\t\t\t\tp[\"nome_$r\"] = ref.nome\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t        p[\"data_$r\"] = ref.data\r\n\t\t\t\t    p[\"giorni_$r\"] = ref.giorni\r\n\t\t\t\t\tp[\"id_$r\"] = ref.id\r\n\t\t\t\t\tp[\"nome_$r\"] = ref.nome\r\n\t\t\t}\r\n    }  \r\n\t\r\n\t\r\n\treferenti_Pratica[p.id]?.each{ rp ->\r\n\t        def r = rp.ruolo.replaceAll(\"\\\\s\",\"\")\r\n\t        if(r.equals(\"Referente\")){\r\n\t\t\t\tif(rp.data > p[\"data_pratica_$r\"]){\r\n\t\t\t\t    p[\"data_pratica_$r\"] = rp.data\r\n\t\t\t\t    p[\"giorni_pratica_$r\"] = rp.giorni_gestore\r\n\t\t\t\t\tp[\"id_pratica_$r\"] = rp.IdReferente_Pratica\r\n\t\t\t\t\tp[\"nome_pratica_$r\"] = rp.NomeReferente_Pratica\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t        p[\"data_pratica_$r\"] = rp.data\r\n\t\t\t\t    p[\"giorni_pratica_$r\"] = rp.giorni_gestore\r\n\t\t\t\t\tp[\"id_pratica_$r\"] = rp.IdReferente_Pratica\r\n\t\t\t\t\tp[\"nome_pratica_$r\"] = rp.NomeReferente_Pratica\r\n\t\t\t}\r\n\t}\r\n\t\r\n    p\r\n    \r\n}\r\n\r\n\r\n\t\r\n\t\r\n\r\n\r\nnew it.sydema.laweb.services.EntitaDerivataSolrService.DeterminazioneEntitaDerivata() {\r\n\tpublic String getNomeCampoChiave() { 'id' }\r\n\r\n\tpublic Collection<?> getCampi() {\r\n\t    [       \r\n\t        [   \r\n            \tnome: 'id',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'nome_istituto',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'ndg',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'intestazione',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'nome_pratica_Referente',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'giorni_pratica_Referente',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'id_pratica_Referente',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'nome_SLE',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'giorni_SLE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'id_SLE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            \r\n            [   \r\n            \tnome: 'nome_LegaleEsterno',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'giorni_LegaleEsterno',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'id_LegaleEsterno',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'nome_pratica_SLE',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'giorni_pratica_SLE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'id_pratica_SLE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'nome_pratica_LegaleEsterno',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'giorni_pratica_LegaleEsterno',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'id_pratica_LegaleEsterno',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'nome_SRE',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'giorni_SRE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'id_SRE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'nome_pratica_SRE',\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n            ],\r\n            [   \r\n            \tnome: 'giorni_pratica_SRE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [   \r\n            \tnome: 'id_pratica_SRE',\t\r\n            \ttipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n            ],\r\n            [\r\n    \t        nome: 'NomeReferente_Prattica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n    \t    ], \r\n    \t    [\r\n    \t        nome: 'IdReferente_Pratica',\r\n    \t        tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n    \t    ], \r\n    \t    [\r\n               nome: 'Id_Ufficio_Referente',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.INTERO\r\n           ],  \r\n           [\r\n               nome: 'Ufficio_Referente',\r\n               tipoDatoCampoEntitaDerivata: TipoDatoCampoEntitaDerivata.STRINGA\r\n           ]\r\n    \t ]\r\n\t}\r\n\t\r\n\tpublic Collection<?> getData() {\r\n        posizioni\r\n\t}\r\n}\r\n    ",
      "className" : "Regola",
      "classeOggetto" : "REGOLA",
      "regola_id" : 15468,
      "configurazioneJson" : null,
      "regolaDeterminazioneContesto_id" : null,
      "tipoCodifica" : "TESTO",
      "obiettivoRegola" : "DETERMINAZIONE_ENTITA_DERIVATA",
      "versione" : null,
      "tipoEsecutore" : "GROOVY",
      "indice" : null,
      "codice" : "PSZNI_RFRGD",
      "descrizione" : "Posizioni - reforged",
      "templateTestoRegola" : null,
      "oggetto_id" : 15468,
      "cartella_id" : null,
      "nomeFileTabellaDecisionale" : null,
      "discriminatore" : null,
      "dominioOggetto" : "REGOLE"
    },
    "entitaDerivata_id" : 49,
    "statoEntitaDerivata" : "ATTIVA",
    "nome" : "Posizioni - Reforged",
    "dataUltimoAggiornamentoDati" : 1554110352359,
    "campiEntiteDerivate" : [ {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_pratica_Referente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2176,
      "nomeFisico" : "nome_pratica_Referente_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "giorni_SRE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2177,
      "nomeFisico" : "giorni_SRE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id_pratica_LegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2178,
      "nomeFisico" : "id_pratica_LegaleEsterno_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_SLE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2179,
      "nomeFisico" : "nome_SLE_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2180,
      "nomeFisico" : "id_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id_pratica_SLE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2181,
      "nomeFisico" : "id_pratica_SLE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id_pratica_SRE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2182,
      "nomeFisico" : "id_pratica_SRE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id_pratica_Referente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2183,
      "nomeFisico" : "id_pratica_Referente_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : false,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "ndg",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2184,
      "nomeFisico" : "ndg_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_LegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2185,
      "nomeFisico" : "nome_LegaleEsterno_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id_SLE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2186,
      "nomeFisico" : "id_SLE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id_SRE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2187,
      "nomeFisico" : "id_SRE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "id_LegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2188,
      "nomeFisico" : "id_LegaleEsterno_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "giorni_pratica_LegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2189,
      "nomeFisico" : "giorni_pratica_LegaleEsterno_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "giorni_pratica_Referente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2190,
      "nomeFisico" : "giorni_pratica_Referente_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_pratica_LegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2191,
      "nomeFisico" : "nome_pratica_LegaleEsterno_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_pratica_SRE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2192,
      "nomeFisico" : "nome_pratica_SRE_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "giorni_pratica_SLE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2193,
      "nomeFisico" : "giorni_pratica_SLE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "giorni_pratica_SRE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2194,
      "nomeFisico" : "giorni_pratica_SRE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "NomeReferente_Prattica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2166,
      "nomeFisico" : "NomeReferente_Prattica_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "IdReferente_Pratica",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2167,
      "nomeFisico" : "IdReferente_Pratica_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_pratica_SLE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2168,
      "nomeFisico" : "nome_pratica_SLE_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "Id_Ufficio_Referente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2169,
      "nomeFisico" : "Id_Ufficio_Referente_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : true,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "Ufficio_Referente",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2170,
      "nomeFisico" : "Ufficio_Referente_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "giorni_LegaleEsterno",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2171,
      "nomeFisico" : "giorni_LegaleEsterno_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "INTERO",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "giorni_SLE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2172,
      "nomeFisico" : "giorni_SLE_i"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_istituto",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2173,
      "nomeFisico" : "nome_istituto_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "intestazione",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2174,
      "nomeFisico" : "intestazione_s"
    }, {
      "multivalore" : null,
      "descrizione" : null,
      "generaFacet" : null,
      "tipoDatoCampoEntitaDerivata" : "STRINGA",
      "entita" : null,
      "ricercaFullText" : null,
      "entitaDerivata_id" : 49,
      "nome" : "nome_SRE",
      "className" : "CampoEntitaDerivata",
      "campoEntitaDerivata_id" : 2175,
      "nomeFisico" : "nome_SRE_s"
    } ],
    "className" : "EntitaDerivata",
    "campoEntitaDerivataUtente_id" : null,
    "campoEntitaDerivataChiave_id" : 2180
  }
} ]